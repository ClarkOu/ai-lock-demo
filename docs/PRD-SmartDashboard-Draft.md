# 智能仪表盘模块 PRD 草稿

> 版本：v1.1 补充章节  
> 日期：2025-12-02  
> 状态：待评审  
> 说明：基于 UI 原型实现，补充至 PRD-v1.1 的 3xx 章节

---

## 模块概述

### 定位

智能仪表盘是门锁系统的可视化分析模块，为不同角色提供数据洞察能力。区别于传统报表的"被动查询"模式，智能仪表盘强调：

- **主动发现问题**：通过数据聚合与异常检测，自动识别需要关注的事项
- **智能归因分析**：不仅展示"是什么"，还尝试分析"为什么"
- **角色定制视图**：不同角色看到与其职责相关的数据和洞察

### 目标用户与权限

| 角色 | 对应仪表盘 | 核心诉求 |
|------|------------|----------|
| 安全主管/值班经理 | 安全运维智能体 | 风险预警、异常行为发现、事后追溯 |
| 运营经理/店长/前台 | 前厅运营看板 | 房态概览、入退房管理、效率分析 |
| 工程部/运维人员 | 安全运维智能体 | 设备健康、故障定位、预防性维护 |

用户根据系统角色自动获得对应仪表盘访问权限，管理员可查看全部仪表盘。

### 入口

在门锁系统左侧导航栏新增"**智能看板**"入口，进入后通过顶部 Tab 切换：数据总览、前厅运营、安全运维。

### 全局能力：通知中心（铃铛）

**用户故事**：
作为门锁系统管理用户，我希望在任何业务页面/智能看板页面都能快速查看“最近需要我关注的事项”，先快速查看详情，必要时前往对应模块处理。

**功能点说明**：

1. 入口与角标
   - 顶部栏右侧提供“铃铛”入口（与系统状态提示并列）。
   - 铃铛角标显示“未读通知数”；当未读数为 0 时角标隐藏。

2. 通知面板（最近通知）
   - 点击铃铛打开通知面板，默认展示“**未读**”列表；支持切换“未读 / 全部”。
   - 列表展示关键信息：所属模块（数据总览/前厅运营/安全运维）、等级（紧急/警告/提示）、标题、时间与简要建议。
   - 支持“一键全部已读”。

3. 已读规则（本版本）
   - 仅当用户打开某条通知的“详情”时，才将该条标记为已读。

4. 跳转与收起行为
   - 点击某条通知后：默认弹出“通知详情”；在详情中可选择“前往”对应的智能看板页面/模块。
   - 当用户切换模块/页面或继续浏览页面内容时，通知面板自动收起，避免遮挡业务视图。

5. 通知设置（邮件为主）
   - 通知面板提供“通知设置”入口，用于配置邮件通知的接收人（To/Cc）与接收等级（紧急/警告/提示）。
   - 本版本不依赖值班表，默认以固定邮箱组/群组邮箱作为收件人配置方式。

### ⚠️ 数据边界说明

**门锁系统可获取的数据**：
- 房间号、房型、楼层
- 发卡时间、到期时间、卡状态、卡类型
- 开门记录（时间、方式、结果）
- 设备状态（在线、离线、电量、信号）
- 操作员信息（工号、操作记录）

**门锁系统无法获取的数据**（存在于 PMS 系统）：
- 客人姓名、联系方式
- VIP 等级、会员信息
- 订单金额、支付信息
- 预订渠道

**设计原则**：仪表盘只展示门锁系统自有数据，不依赖 PMS 集成。所有模块设计均遵循此边界。

---

## 3xx 智能仪表盘

### 通用能力：看板导出（PDF）

**用户故事**：
作为门锁系统管理用户，我希望在智能看板页面快速导出当前看板视图形成可分享的“报告”，用于交接与复盘。

**功能点说明**：

1. 入口与范围
   - 在三张智能看板页面（数据总览/前厅运营/安全运维）提供“导出 PDF”入口。
   - 导出内容为“当前看板页面的可视化视图与关键模块内容”（用于汇报/交接），不提供原始明细数据导出。

2. 与报表的关系（边界）
   - 导出 PDF 不替代门锁系统既有“报表”能力；数据查询与明细导出仍以报表模块为主。

3. 导出结果
   - 导出结果为单个 PDF 文件，便于留档、发送与打印。

### [300] 智能看板总览

**用户故事**：
作为系统管理员/酒店管理层，我希望快速了解门锁系统整体运行状态和关键指标，发现需要重点关注的问题区域，以便做出及时决策和资源调配。

**功能点说明**：

1. 页面入口与布局
   - 在"智能看板"模块中，总览为第一个 Tab 页（默认首页）
   - 页面分为三个区块：AI 智能诊断中心、运营效率透视、24 小时安全态势
   - 三个区块垂直排列，一屏显示完整内容

2. AI 智能诊断中心
   - **功能描述**：基于门锁系统数据自动检测异常，按严重程度分为三类展示
   - **异常检测规则**：
     
     **紧急关注类**（需立即处理）：
     - **飞房检测**：房间无有效宾客卡（卡已过期或已退房）的情况下被开门，排除员工卡/管理卡开门 ==【需开门事件数据】==
     - **员工深夜异常开门**：员工卡在 00:00-06:00 期间开门，且开启的是在住房间（有有效宾客卡） ==【需开门事件数据】==
     - **员工短时多房访问**：同一员工卡在 1 小时内开启 ≥ 5 间不同房间 ==【需开门事件数据】==
     - **敏感卡异常使用**：总卡/应急卡/楼栋卡单日使用次数 ≥ 5 次 ==【需开门事件数据】==
     - **连续鉴权失败**：同一张卡在同一门锁连续鉴权失败 ≥ 3 次 ==【需开门事件数据】==
     
     **待处理类**（需跟进但不紧急）：
     - **换卡频繁**：同一房间在入住期间换卡次数 ≥ 3 次
     - **退房延迟**：卡已到期超过 2 小时但未办理退房（无新卡发放）
     - **门未关超时**：门开启状态持续超过 5 分钟（需门磁传感器支持） ==【需门磁状态数据】==
     
     **建议优化类**（可改进项）：
     - **电量预警**：设备电量 ≤ 20%
     - **信号弱**：设备信号强度低于阈值，通信成功率 < 95%
     - **设备离线**：设备离线超过 30 分钟
   
   - **展示内容**：
     - 三张卡片分别对应三个类别
     - 每张卡片显示：分类名称、问题数量、最典型的 1-2 个问题描述
   - **点击展开弹窗**：
     - 弹窗标题显示分类名称和问题总数
     - 列表展示该分类下所有问题，每条包含：
       - 问题标题（如"0815房疑似飞房"）
       - 发生时间
       - 涉及对象（房间号/员工姓名/设备编号）
       - 问题详情描述
       - 建议操作（如"建议核实该房间入住情况"）
   - 点击单条问题可跳转至 [301] 安全运维智能体 的对应事件详情

3. 运营效率透视
   - **功能描述**：展示 4 个核心运营效率指标，每个指标包含当前值、对比值、智能洞察
   - **指标定义与计算**：
     
     **退房→空净 平均耗时**
     - 计算公式：从客人退房到房间清洁完成的平均时间（分钟）
     - 对比值：较上周的变化
     - 洞察示例：“瓶颈: 14:00-15:00 退房高峰，保洁人手不足”
     
     **入住→首次开门 平均间隔**
     - 计算公式：从发卡入住到客人第一次开门的平均时间（分钟）
     - 对比值：较上周的变化
     - 洞察示例：“说明: 发卡后客人能快速找到房间”
     
     **门未关告警 平均响应**
     - 计算公式：告警产生到处理完成的平均时间（分钟）
     - 对比值：行业标准值
     - 洞察示例：“建议: 优化告警推送至保洁手机”
     
     **超时退房 占比**
     - 计算公式：超过12:00退房的房间数 / 当日应退房数 × 100%
     - 对比值：较上周的变化
     - 洞察示例：“建议: 11:30推送退房提醒至客人手机”
   
   - **智能洞察生成规则**：
     - 入住率 ≥ 85% 且为周五/周六：显示"周末入住高峰，建议关注前台人手"
     - 入住率较昨日上升 ≥ 10%：显示"入住率显著上升"
     - 发卡耗时较上周下降 ≥ 15%：显示"发卡效率明显提升"
     - 设备在线率 < 98%：显示"X 台设备离线，建议检查"
     - 其他情况显示通用洞察或为空
   
   - **交互功能**：
     - 点击指标卡片跳转至 [302] 前厅运营看板 对应模块

4. 24 小时安全态势
   - **功能描述**：时间轴可视化展示过去 24 小时（从当前时间往前推 24 小时）的安全事件 ==【整体依赖开门事件数据】==
   - **安全事件分类**：
     
     **异常访问类**（红色标记）：
     - 飞房开门（同 AI 诊断规则） ==【需开门事件数据】==
     - 员工深夜异常开门（同 AI 诊断规则） ==【需开门事件数据】==
     - 员工短时多房访问（同 AI 诊断规则） ==【需开门事件数据】==
     - 连续鉴权失败（同 AI 诊断规则） ==【需开门事件数据】==
     - 敏感卡使用（总卡/应急卡/楼栋卡每次使用都记录） ==【需开门事件数据】==
     
     **门状态异常类**（橙色标记）：
     - 门未关超时（开启超过 5 分钟） ==【需门磁状态数据】==
     - 非正常时段开门（00:00-06:00 期间的开门记录，排除正常入住/退房） ==【需开门事件数据】==
   
   - **时间轴展示**：
     - 横轴代表 24 小时，从当前时间往前 24 小时
     - 当前时间用竖线标记，竖线跟随真实时间移动
     - 事件点按发生时间定位在轴上，不同类型用不同颜色区分
     - 图例说明各颜色含义
   
   - **事件详情提示**：
     - 鼠标悬停事件点显示：事件时间、涉及房间/人员、事件描述
   - 点击事件点跳转至 [301] 安全运维智能体 对应事件详情

5. 数据刷新
   - AI 诊断中心：每 30 秒自动刷新检测结果
   - 运营效率透视：每 1 分钟自动刷新指标数据
   - 24 小时安全态势：当前时间线每秒更新，事件数据每 30 秒刷新
   - 页面提供手动刷新按钮，点击后立即刷新所有数据

6. 权限控制
   - 具有"智能看板"权限的用户可访问
   - 总览页面作为默认首页，向下兼容各角色（安全/运营/运维/前台）的查看权限

**验收标准**：
- 所有异常检测规则正确触发，无漏报（漏报率 < 5%）、无明显误报（误报率 < 10%）
- 运营指标计算结果与手动 SQL 查询结果一致
- 24 小时时间轴事件位置准确，当前时间指示误差 < 5 秒
- 点击卡片/事件正确弹出详情或跳转到目标页面
- 数据刷新按预期频率执行，页面无卡顿
- 三个区块在 1920×1080 分辨率下无需滚动

---

### [301] 安全运维智能体

**用户故事**：
作为安全主管/值班经理，我希望实时掌握门锁系统的安全态势，快速识别异常事件并做出响应，以便保障酒店安全运营。

**功能点说明**：

1. 页面入口与布局
   - 在"智能看板"模块中，安全运维为第三个 Tab 页
   - 页面顶部显示仪表盘名称、最后更新时间、刷新按钮
   - 整体布局分为四个区域：统计卡片区（顶部）→ 模块区（中部，左右分栏）→ AI 洞察区（底部）

2. 统计卡片（顶部，5 个指标）
   - **系统健康评分**：综合评分（满分100），副指标显示较昨日变化和影响因素
   - **异常事件（今日）**：异常事件总数，副指标显示安全事件数 · 设备事件数
   - **离线设备**：当前离线设备数，副指标显示超4小时需优先处理的数量
   - **低电量预警**：低电量设备数，副指标显示电量<10%需立即更换的数量
   - **网关在线率**：网关在线百分比，副指标显示在线/总数
   - 每个卡片支持点击下钻查看明细

3. 实时安全事件（左侧主区域，占页面约 2/3 宽度）
   - 展示形式：时间轴列表，按时间倒序排列，最新事件在最上方
   - 每条事件包含：时间戳、房间号、事件描述、事件来源
   - 事件紧急程度标记：
     - 🔴 critical（红色）：开门连续失败、敏感卡异常使用
     - 🟡 warning（黄色）：非授权时段开门、单次鉴权失败
     - 🔵 info（蓝色）：通信超时、设备状态变更
   - 支持按事件类型筛选（全部 / 安全事件 / 设备事件），Tab 显示对应数量角标
   - 支持按时间范围筛选（今日 / 近24小时 / 近7天）
   - 点击单条事件可展开详情弹窗，显示完整上下文

4. 问题设备模块（右侧区域，占页面约 1/3 宽度）
   - 展示形式：Tab 切换（离线设备 / 低电量设备）+ 设备列表
   - 每个 Tab 显示对应设备数量角标
   - 每个设备项包含：房间号、状态图标、问题描述
   - 设备按严重程度排序，critical 在前
   - 点击设备可跳转至设备详情页面

5. AI 智能洞察（底部固定区域）
   - 展示 2-3 条 AI 生成的安全相关洞察
   - 洞察侧重：风险预警、异常模式识别、区域聚集分析
   - 示例洞察：
     - "3楼本周开门失败率 8.5%，较全店平均(3.2%)高出 166%，集中在 0312-0315 房间"
     - "1205房间今日凌晨有 3 次异常开门尝试，建议核实"
   - 点击"追问 HostPilot"可打开 AI 助手继续对话
   - 详细规范见 [304] AI 智能洞察卡片

6. 数据刷新
   - 自动刷新频率：约 1 分钟
   - 刷新方式：静默刷新，数据变化时数字平滑更新
   - 右上角显示"更新于 HH:mm:ss"
   - 支持用户手动点击刷新按钮立即刷新

7. 异常标记规则
   - 敏感卡（总卡/应急卡/楼栋卡）单日使用 ≥ 5 次：行高亮 + 告警
   - 空房状态下被开门：标记"空房开门"标签
   - 非工作时段（如 0:00-6:00）操作：标记"非工作时段"标签
   - 同一卡连续鉴权失败 ≥ 3 次：标记"疑似异常卡"标签

**验收标准**：
- 事件列表实时更新延迟 ≤ 5 秒
- 统计数据与数据库查询结果一致性 100%
- 异常事件正确分类率 ≥ 95%
- 页面首次加载时间 ≤ 3 秒

---

### [302] 前厅运营看板

**用户故事**：
作为运营经理/店长/前台，我希望快速了解门店房态和经营状况，掌握今日入退房情况，以便做出数据驱动的决策和高效安排前台服务工作。

**功能点说明**：

1. 页面入口与布局
   - 在"智能看板"模块中，前厅运营为第二个 Tab 页
   - 页面顶部显示仪表盘名称"前厅运营智能体"、最后更新时间、刷新按钮
   - 整体布局：统计卡片区（顶部 5 个）→ 模块区（第一行 3 列 + 第二行 2 列）→ AI 洞察区（底部）

2. 统计卡片（顶部，5 个指标）
   - **当前入住率**：在住房间数 / 可用房间总数 × 100%
     - 副指标：较昨日升降趋势（绿色↑/红色↓）+ 在住/总房数（如"在住 122/156"）
   - **今日入住**：当日新发卡入住的房间数
     - 副指标：显示执行进度（如"待办 18 · 已办 24"）
   - **今日退房**：当日房卡到期的房间数
     - 副指标：显示执行进度（如"待退 15 · 已退 23"）
   - **异常关注**：需要关注的异常事项数量（红色高亮）
     - 副指标：异常类型提示（如"即将到期 5"）
   - **平均入住时长**：当前在住房间的平均住店天数（保留 1 位小数）
     - 副指标：较昨日变化趋势
   - 每个卡片支持点击下钻查看明细列表

3. 今日房态模块（第一行左侧）
   - **功能描述**：展示今日入退房的房间列表，支持 Tab 切换
   - **Tab 切换**：
     - "今日退房"：房卡今日到期的房间
     - "今日入住"：今日发卡入住的房间
     - 每个 Tab 显示对应房间数角标
   - **列表内容**：
     - 房间号（彩色徽章样式）
     - 时间信息（退房时间 / 发卡入住时间）
     - 入住信息（入住日期 + 入住天数 / 预住天数 + 退房日期）
     - 状态标签：在住/已退/已入住

4. 入住时长分布（第一行中间）
   - 展示形式：4 条横向进度条，显示各时长区间的房间占比
   - 分类定义：
     - 当日房：入住时长 ≤ 1 天，绿色进度条
     - 短住：入住时长 2-3 天，金色进度条
     - 中住：入住时长 4-7 天，蓝色进度条
     - 长住：入住时长 > 7 天，紫色进度条
   - 每条进度条显示房间数、占比百分比
   - 顶部显示总在住房间数（如"共 124 间在住"）

5. 房型入住统计（第一行右侧）
   - 展示形式：4 条横向进度条，显示各房型的入住率
   - 房型分类：大床房、双床房、套房、其他
   - 每条进度条显示：
     - 房型名称
     - 入住数 / 总房量（如"45/60"）
     - 入住率百分比（如"75%"）
     - 不同房型使用不同颜色进度条（绿色、蓝色、金色、紫色）
   - 顶部显示总房量（如"总房量 156 间"）

6. 入住率趋势图（第二行左侧）
   - 展示形式：折线图，展示近 7 天入住率变化
   - X 轴：日期 + 星期（如"12/4 周三"）
   - Y 轴：入住率百分比，刻度范围 40%-100%
   - 数据点交互：鼠标悬停显示具体入住率和房间数
   - 加载动画：页面进入时折线有绘制动画效果
   - 高峰标记：入住率 ≥ 90% 的数据点显示 🔥 图标

7. 本周入住高峰热力图（第二行右侧）
   - 展示形式：热力图，时段 × 星期 的矩阵
   - X 轴：时段（06:00-22:00，每 2-3 小时一格）
   - Y 轴：星期（周一至周日）
   - 颜色深浅：表示该时段入住数量，颜色越深数量越多
   - 交互：鼠标悬停显示具体入住间数（如"周五 14:00 - 18间"）
   - 数据规律参考：高峰通常集中在 14:00-18:00，周五周六整体较高

8. AI 前厅运营洞察（底部固定区域）
   - 展示 3-4 条 AI 生成的运营与服务相关洞察
   - 洞察内容融合服务提醒和运营建议：
     - 异常跟进提醒（如"0305、0402、0608 房间超时未退房，建议确认续住或退房意向"）
     - 入住高峰提醒（如"今日入住高峰预计在 17:00-19:00，尚有 18 间预抵，建议前台增加人手"）
     - 房型平衡建议（如"双床房入住率达 84%，建议优先推荐大床房（75%）平衡房态"）
     - 明日预测（如"明日预订量较高（51间），12层、15层预计满房，注意协调清洁排班"）
   - 点击"深入了解"可打开 AI 助手继续对话

9. 数据刷新与加载
   - 自动刷新频率：约 1 分钟
   - 页面加载动画：统计卡片数字滚动效果、模块依次淡入、图表绘制动画
   - 右上角显示最后更新时间（HH:mm:ss）

10. 数据边界说明
    - 所有数据均来自门锁系统发卡记录和房间信息
    - 在住 = 房间有有效房卡（未过期）
    - 退房 = 房卡已到期
    - 不显示客人姓名、预订信息等门锁系统边界外的数据

**验收标准**：
- 入住率计算与有效房卡数一致，误差 < 0.5%
- 今日房态列表数据与发卡记录一致
- 趋势图数据点与实际数据完全一致
- 热力图正确反映入住时段分布规律
- 页面首次加载时间 ≤ 3 秒，动画流畅无卡顿
- Tab 切换响应时间 ≤ 200ms

---

### [303] 设备运维中心（本版本已合并）

说明：在 v1.1 的 UI 原型中，不提供独立的“设备运维”Tab；设备相关内容已合并到 [301] 安全运维智能体中统一呈现（如：网关在线率、离线/低电量设备、设备类事件流）。本章节保留为后续版本规划，不纳入本版本验收范围。

---

### [304] AI 智能洞察卡片

**用户故事**：
作为仪表盘用户，我希望看到 AI 自动生成的数据洞察和分析建议，帮助我快速发现问题和机会，而无需自己分析大量数据。

**功能点说明**：

1. 展示位置
   - 位置：每个仪表盘页面底部固定区域

2. 头部信息与操作
   - 头部信息包含：洞察标题（如“AI 前厅运营洞察 / AI 安全运维洞察”）、洞察标签（如“实时分析 / 综合分析”）、分析时间
   - 分析时间可附带数据来源（如“数据来源: sys_log, device_status”）
   - “分析时间”和“深入了解/追问 HostPilot”按钮与标题信息保持同一行展示，减少占行
   - 点击“深入了解/追问 HostPilot”进入 AI 助手对话，并自动带入当前仪表盘的上下文

3. 内容结构
   - 洞察条目：展示 2-4 条 AI 生成的洞察要点
   - 每条洞察至少包含：
     - 数据事实（是什么）：具体的数据指标或现象描述
     - 处置/建议（怎么做）：给出明确的下一步动作
   - 可选增强：与平均值/历史周期的对比、可能归因（简述即可）

3. 各仪表盘洞察侧重
   - **安全运维**：风险预警、异常模式识别、区域聚集分析
     - 示例："3楼本周开门失败率 8.5%，较全店平均(3.2%)高出 166%，集中在 0312-0315 房间"
   - **前厅运营**：服务提醒、运营趋势、房型平衡、入住预测
     - 示例："0305、0402、0608 房间超时未退房，建议确认续住或退房意向"
     - 示例："今日入住高峰预计在 17:00-19:00，尚有 18 间预抵，建议前台增加人手"
     - 示例："双床房入住率达 84%，建议优先推荐大床房（75%）平衡房态"
    - **安全运维（设备侧）**：离线/低电量预警、网关/通信稳定性、故障模式识别
       - 示例："低电量设备 2 台（其中 1 台 <10%），建议优先更换电池"

4. 更新与交互
   - 洞察随页面数据刷新而更新，并在头部展示“分析时间”
   - 点击“深入了解/追问 HostPilot”进入 AI 助手对话，可基于当前洞察继续追问

5. 内容边界
   - 洞察不包含客人姓名等 PII 信息（遵循数据边界说明）
   - 洞察应给出可执行的处置建议，但避免输出超出系统能力边界的指令

**验收标准**：
- 洞察内容准确反映数据事实，无编造或幻觉
- 洞察首次生成时间 ≤ 3 秒
- 降级策略在 AI 不可用时正确触发
- 追问功能正确传递上下文至 HostPilot

---

### [305] 数据刷新与状态指示（通用规范）

**功能点说明**：

#### 1. 刷新机制

| 刷新类型 | 频率 | 方式 |
|---------|------|------|
| 自动刷新 | 约 1 分钟 | 静默刷新，数字直接更新 |
| 手动刷新 | 用户触发 | 点击刷新按钮 |

#### 2. 状态指示

- **更新时间**：右上角显示"更新于 HH:mm:ss"
- **刷新动画**：刷新时数字有淡入效果，折线图有绘制动画
- **状态栏**：底部显示系统状态（制卡机、门锁服务、云服务），所有页面统一

#### 3. 加载动画

页面首次加载时：
- 统计卡片数字滚动效果
- 模块卡片依次淡入
- 图表有绘制动画

---

## 与 PRD 其他章节的关联

### 与 [209] HostPilot 助手的关联

- 每个仪表盘的 AI 洞察卡片可点击"追问 HostPilot"
- HostPilot 可回答仪表盘相关问题（如"3楼为什么开门失败率高"）
- HostPilot 可引导用户查看对应仪表盘

### 与 [602] 异常处理的关联

仪表盘中的 AI 洞察遵循 [602] 异常处理规范：
- 无数据时显示"暂无洞察"
- 生成超时时降级为规则统计
- 不编造或猜测数据

### 与 [501] 权限控制的关联

- 用户只能看到有权限的仪表盘
- 数据范围受用户门店权限控制
- 跨门店用户可切换查看范围

---

## 验收标准汇总

| 维度 | 标准 |
|------|------|
| 数据准确性 | 仪表盘数据与后台数据一致性 ≥ 99.9% |
| 实时性 | 事件数据延迟 ≤ 10 秒 |
| 加载性能 | 页面首次加载 ≤ 3 秒 |
| AI 洞察 | 洞察生成成功率 ≥ 95%，准确率 ≥ 90% |
| 交互体验 | 动画流畅，无卡顿 |
| 兼容性 | 支持 Chrome/Edge/Safari 最新两个版本 |

---

## 附录：数据来源映射

| 模块 | 主要数据表 |
|------|-----------|
| 安全事件 | `sys_log`, `sys_event` |
| 入住统计 | `guest_make_card_record`, `room_info` |
| 设备状态 | `device_status`, `gateway_status` |
| 运维任务 | `work_order`, `task_queue` |

---

*此文档为智能仪表盘 PRD 补充章节草稿，待评审后合并至 PRD-v1.1*
