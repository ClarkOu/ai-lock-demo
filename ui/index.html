<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Êô∫ËÉΩÈó®ÈîÅÁÆ°ÁêÜÁ≥ªÁªü</title>
    <script>
        (function () {
            // Default to English on GitHub Pages, without affecting local file preview.
            try {
                if (location.protocol === 'file:') return;
                if (!/\.github\.io$/i.test(location.hostname)) return;

                const target = new URL('./en/index-en.html', location.href);
                target.search = location.search;
                target.hash = location.hash;

                // Avoid redirect loops if user is already on the English entry.
                if (location.pathname.endsWith('/en/index-en.html')) return;

                location.replace(target.toString());
            } catch (e) {
                // Ignore redirect failures.
            }
        })();
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Microsoft YaHei", "PingFang SC", sans-serif;
            overflow: hidden;
        }

        /* ‰∏ªÂÜÖÂÆπ iframe */
        .main-frame {
            width: 100%;
            height: 100vh;
            border: none;
        }

        .notify-panel {
            position: fixed;
            top: 68px;
            right: 18px;
            width: 360px;
            max-width: calc(100vw - 36px);
            background: #ffffff;
            border: 1px solid rgba(26, 42, 74, 0.22);
            border-radius: 14px;
            overflow: hidden;
            z-index: 10002;
            display: none;
            background-clip: padding-box;
            box-shadow:
                0 18px 48px rgba(0,0,0,0.18),
                0 0 0 1px rgba(26, 42, 74, 0.10);
        }

        .notify-panel.show {
            display: block;
        }

        .notify-header {
            padding: 12px 14px;
            background: linear-gradient(90deg, #1a2a4a 0%, #233556 100%);
            color: #c9a961;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .notify-header .title {
            font-size: 14px;
            font-weight: 700;
            letter-spacing: 0.2px;
        }

        .notify-header button {
            border: none;
            background: rgba(255,255,255,0.10);
            color: #c9a961;
            padding: 6px 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            line-height: 1;
        }

        .notify-header button:hover {
            background: rgba(255,255,255,0.14);
        }

        .notify-controls {
            padding: 10px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 1px solid rgba(26, 42, 74, 0.10);
            background: #ffffff;
        }

        .notify-seg {
            border: 1px solid rgba(26, 42, 74, 0.12);
            background: rgba(26, 42, 74, 0.04);
            color: #1a2a4a;
            font-size: 12px;
            padding: 6px 10px;
            border-radius: 999px;
            cursor: pointer;
        }

        .notify-seg:hover {
            background: rgba(26, 42, 74, 0.06);
        }

        .notify-seg.active {
            background: #c9a961;
            border-color: rgba(201, 169, 97, 0.65);
            color: #1a2a4a;
            font-weight: 700;
        }

        .notify-controls .spacer {
            flex: 1;
        }

        .notify-link {
            border: none;
            background: transparent;
            color: #1a2a4a;
            font-size: 12px;
            cursor: pointer;
            padding: 6px 6px;
            border-radius: 8px;
        }

        .notify-link:hover {
            background: rgba(26, 42, 74, 0.05);
        }

        .notify-list {
            max-height: 420px;
            overflow: auto;
            padding: 10px;
            background: #ffffff;
        }

        .notify-item {
            padding: 10px 12px;
            border: 1px solid rgba(26, 42, 74, 0.14);
            color: #333;
            cursor: pointer;
            background: #ffffff;
            border-left: 3px solid transparent;
            border-radius: 12px;
            box-shadow: 0 1px 0 rgba(0,0,0,0.04);
        }

        .notify-item + .notify-item {
            margin-top: 10px;
        }

        .notify-item.unread {
            border-left-color: rgba(201, 169, 97, 0.95);
        }

        .notify-item:hover {
            border-color: rgba(26, 42, 74, 0.22);
            box-shadow: 0 10px 28px rgba(0,0,0,0.12);
        }

        .notify-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .notify-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: transparent;
            flex-shrink: 0;
        }

        .notify-item.unread .notify-dot {
            background: #c9a961;
        }

        .notify-pill {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 999px;
            background: rgba(26, 42, 74, 0.08);
            color: #1a2a4a;
            flex-shrink: 0;
        }

        .notify-level {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 999px;
            background: rgba(0,0,0,0.06);
            color: #555;
            flex-shrink: 0;
        }

        .notify-level.urgent { background: rgba(244, 67, 54, 0.12); color: #b71c1c; }
        .notify-level.warning { background: rgba(255, 152, 0, 0.14); color: #a35b00; }
        .notify-level.info { background: rgba(33, 150, 243, 0.12); color: #0d47a1; }

        .notify-title {
            font-size: 13px;
            color: #111;
            font-weight: 600;
            line-height: 1.35;
        }

        .notify-item .meta {
            margin-top: 6px;
            font-size: 11px;
            color: #6b7280;
            line-height: 1.35;
        }

        .notify-empty {
            padding: 26px 14px;
            color: #6b7280;
            font-size: 13px;
            text-align: center;
        }

        /* ÈÄöÁü•ËØ¶ÊÉÖÂºπÁ™ó */
        .notify-detail-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            z-index: 10010;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 18px;
        }

        .notify-detail-overlay.show {
            display: flex;
        }

        .notify-detail-modal {
            width: 560px;
            max-width: calc(100vw - 36px);
            background: #ffffff;
            border: 1px solid rgba(26, 42, 74, 0.18);
            border-radius: 14px;
            overflow: hidden;
            box-shadow:
                0 20px 60px rgba(0,0,0,0.22),
                0 0 0 1px rgba(26, 42, 74, 0.10);
        }

        .notify-detail-header {
            padding: 12px 14px;
            background: linear-gradient(90deg, #1a2a4a 0%, #233556 100%);
            color: #c9a961;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .notify-detail-header .title {
            font-size: 14px;
            font-weight: 700;
            letter-spacing: 0.2px;
        }

        .notify-detail-close {
            border: none;
            background: rgba(255,255,255,0.10);
            color: #c9a961;
            width: 30px;
            height: 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 18px;
            line-height: 1;
        }

        .notify-detail-close:hover {
            background: rgba(255,255,255,0.14);
        }

        .notify-detail-body {
            padding: 14px;
        }

        .notify-detail-badges {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .notify-detail-time {
            color: rgba(26, 42, 74, 0.70);
            font-size: 12px;
        }

        .notify-detail-title {
            font-size: 16px;
            color: #111;
            font-weight: 700;
            line-height: 1.35;
            margin-bottom: 10px;
        }

        .notify-detail-meta {
            font-size: 13px;
            color: #334155;
            line-height: 1.6;
        }

        .notify-detail-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            padding: 12px 14px;
            border-top: 1px solid rgba(26, 42, 74, 0.10);
            background: #ffffff;
        }

        .notify-detail-actions button {
            border: none;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 10px;
            font-size: 13px;
            line-height: 1;
        }

        .notify-detail-actions .btn-secondary {
            background: rgba(26, 42, 74, 0.06);
            color: #1a2a4a;
        }

        .notify-detail-actions .btn-secondary:hover {
            background: rgba(26, 42, 74, 0.08);
        }

        .notify-detail-actions .btn-primary {
            background: #c9a961;
            color: #1a2a4a;
            font-weight: 700;
        }

        .notify-detail-actions .btn-primary:hover {
            filter: brightness(0.98);
        }

        /* Âè≥‰∏ãËßíÊÇ¨ÊµÆÁêÉ */
        .ai-float-btn {
            position: fixed;
            right: 30px;
            bottom: 30px;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #c9a961 0%, #a68a3a 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(201, 169, 97, 0.4);
            z-index: 10001;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .ai-float-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 24px rgba(201, 169, 97, 0.5);
        }

        .ai-float-btn:active {
            transform: scale(0.95);
        }

        .ai-float-btn svg {
            width: 26px;
            height: 26px;
            fill: #1a2a4a;
            transition: transform 0.3s ease;
        }

        .ai-float-btn.active {
            background: linear-gradient(135deg, #1a2a4a 0%, #2a3a5a 100%);
            box-shadow: 0 4px 16px rgba(26, 42, 74, 0.4);
        }

        .ai-float-btn.active svg {
            fill: #c9a961;
            transform: rotate(90deg);
        }

        .ai-float-btn .icon-chat { display: block; }
        .ai-float-btn .icon-close { display: none; }
        .ai-float-btn.active .icon-chat { display: none; }
        .ai-float-btn.active .icon-close { display: block; }

        /* AIÂä©ÊâãÊµÆÂä®Èù¢Êùø */
        .ai-panel {
            position: fixed;
            right: 30px;
            bottom: 100px;
            width: 480px;
            height: 680px;
            max-height: calc(100vh - 140px);
            background: #ffffff;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            overflow: hidden;
            z-index: 10000;
            transform: scale(0.9) translateY(20px);
            opacity: 0;
            visibility: hidden;
            transform-origin: bottom right;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .ai-panel.show {
            transform: scale(1) translateY(0);
            opacity: 1;
            visibility: visible;
        }

        .ai-header {
            background: linear-gradient(90deg, #1a2a4a 0%, #2a3a5a 100%);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ai-header h3 {
            color: #c9a961;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-header h3 svg {
            width: 20px;
            height: 20px;
        }

        .ai-close {
            color: #8899aa;
            cursor: pointer;
            font-size: 20px;
            background: none;
            border: none;
        }

        .ai-close:hover {
            color: #ffffff;
        }

        .ai-expand {
            color: #8899aa;
            cursor: pointer;
            font-size: 16px;
            background: none;
            border: none;
            margin-right: 10px;
        }

        .ai-expand:hover {
            color: #ffffff;
        }

        .ai-header-btns {
            display: flex;
            align-items: center;
        }

        /* ÊîæÂ§ßÊ®°Âºè */
        .ai-panel.expanded {
            right: 50%;
            bottom: 50%;
            transform: translate(50%, 50%) !important;
            width: 900px;
            height: 92vh;
            max-height: 92vh;
            transform-origin: center center;
        }

        .ai-panel.expanded.show {
            transform: translate(50%, 50%) !important;
        }

        /* Artifacts Canvas Ê®°ÂºèÔºàÂ∑¶Âè≥ÂàÜÊ†èÔºâ */
        .ai-panel.canvas-mode {
            width: 880px;
        }
        .ai-panel.canvas-mode.expanded {
            width: 1100px;
        }
        .ai-panel-body {
            display: flex;
            flex: 1;
            min-height: 0;
            overflow: hidden;
        }
        /* Â∑¶‰æß Canvas Âå∫Âüü */
        .ai-canvas {
            width: 0;
            min-width: 0;
            background: linear-gradient(180deg, #f0f4f8 0%, #e8ecf1 100%);
            border-right: 1px solid #dde3ea;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: width 0.35s cubic-bezier(0.4, 0, 0.2, 1), min-width 0.35s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .ai-panel.canvas-mode .ai-canvas {
            width: 380px;
            min-width: 380px;
        }
        .ai-canvas-header {
            padding: 12px 16px;
            background: rgba(26, 42, 74, 0.04);
            border-bottom: 1px solid #dde3ea;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .ai-canvas-header .title {
            font-size: 13px;
            font-weight: 600;
            color: #1a2a4a;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .ai-canvas-close {
            background: none;
            border: none;
            color: #8899aa;
            cursor: pointer;
            font-size: 18px;
            padding: 4px;
            border-radius: 6px;
        }
        .ai-canvas-close:hover {
            background: rgba(0,0,0,0.06);
            color: #1a2a4a;
        }
        .ai-canvas-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 24px;
            text-align: center;
        }
        /* Âè≥‰æßÂØπËØùÂå∫ÂüüÂåÖË£Ö */
        .ai-chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }

        /* Canvas ÂÜÖÂÆπÁä∂ÊÄÅ */
        .canvas-stage { display: none; width: 100%; }
        .canvas-stage.active { display: flex; flex-direction: column; align-items: center; }

        /* Èò∂ÊÆµ1ÔºöÂæÖÊú∫ÂºïÂØº */
        .canvas-waiting .card-icon {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #c9a961 0%, #a68a3a 100%);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            position: relative;
            box-shadow: 0 8px 32px rgba(201, 169, 97, 0.3);
        }
        .canvas-waiting .card-icon svg {
            width: 56px;
            height: 56px;
            fill: #1a2a4a;
        }
        .canvas-waiting .card-icon::after {
            content: '';
            position: absolute;
            width: 140px;
            height: 140px;
            border: 2px solid rgba(201, 169, 97, 0.4);
            border-radius: 50%;
            animation: pulse-ring 2s ease-out infinite;
        }
        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 1; }
            100% { transform: scale(1.3); opacity: 0; }
        }
        .canvas-waiting .hint {
            font-size: 18px;
            font-weight: 600;
            color: #1a2a4a;
            margin-bottom: 8px;
        }
        .canvas-waiting .sub-hint {
            font-size: 13px;
            color: #6b7a8a;
        }
        
        /* ÊºîÁ§∫Âú∫ÊôØÊåâÈíÆÂå∫ - Âõ∫ÂÆöÂú®canvasÂ∫ïÈÉ® */
        .demo-scenarios {
            padding: 16px;
            border-top: 1px dashed #e0e0e0;
            background: #fafafa;
        }
        .demo-scenarios .demo-title {
            font-size: 12px;
            color: #999;
            margin-bottom: 10px;
            text-align: center;
        }
        .demo-scenarios .demo-buttons {
            display: flex;
            flex-direction: column;
            gap: 6px;
            align-items: center;
        }
        .demo-scenarios .demo-row {
            display: flex;
            gap: 6px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .demo-btn {
            padding: 5px 10px;
            border-radius: 14px;
            border: none;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            background: #fff;
            color: #666;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            white-space: nowrap;
        }
        .demo-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
        }
        .demo-btn.error {
            background: #ffebee;
            color: #c62828;
        }
        .demo-btn.error:hover {
            background: #ffcdd2;
        }
        .demo-btn.warning {
            background: #fff8e1;
            color: #f57c00;
        }
        .demo-btn.warning:hover {
            background: #ffecb3;
        }
        .demo-btn.success {
            background: #e8f5e9;
            color: #2e7d32;
        }
        .demo-btn.success:hover {
            background: #c8e6c9;
        }

        /* Èò∂ÊÆµ2ÔºöÂàÜÊûê‰∏≠ */
        .canvas-analyzing .scan-animation {
            width: 140px;
            height: 140px;
            position: relative;
            margin-bottom: 24px;
        }
        .canvas-analyzing .scan-card {
            width: 100px;
            height: 66px;
            background: linear-gradient(135deg, #c9a961 0%, #a68a3a 100%);
            border-radius: 8px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 4px 16px rgba(201, 169, 97, 0.4);
        }
        .canvas-analyzing .scan-line {
            position: absolute;
            top: 0;
            left: 50%;
            width: 120px;
            height: 4px;
            background: linear-gradient(90deg, transparent, #4fc3f7, transparent);
            transform: translateX(-50%);
            animation: scan-move 1.5s ease-in-out infinite;
            border-radius: 2px;
        }
        @keyframes scan-move {
            0%, 100% { top: 10px; opacity: 0.5; }
            50% { top: 130px; opacity: 1; }
        }
        .canvas-analyzing .status-text {
            font-size: 15px;
            color: #1a2a4a;
            font-weight: 500;
            margin-bottom: 16px;
        }
        .canvas-analyzing .analyzing-steps {
            display: flex;
            flex-direction: column;
            gap: 10px;
            text-align: left;
            width: 100%;
            max-width: 200px;
        }
        .canvas-analyzing .step-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 13px;
            color: #999;
            transition: all 0.3s;
        }
        .canvas-analyzing .step-item.active {
            color: #1a2a4a;
        }
        .canvas-analyzing .step-item.done {
            color: #2e7d32;
        }
        .canvas-analyzing .step-icon {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        .canvas-analyzing .step-item.active .step-icon {
            background: #c9a961;
        }
        .canvas-analyzing .step-item.active .step-icon.loading {
            background: transparent;
            border: 2px solid #c9a961;
            border-top-color: transparent;
            animation: spin 0.8s linear infinite;
        }
        .canvas-analyzing .step-item.done .step-icon {
            background: #4caf50;
        }
        .canvas-analyzing .step-item.done .step-icon::after {
            content: '‚úì';
            color: white;
            font-size: 11px;
            font-weight: bold;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Èò∂ÊÆµ3ÔºöÁªìÊûú */
        .canvas-result .result-card {
            width: 100%;
            max-width: 320px;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .canvas-result .result-header {
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .canvas-result .result-header.error {
            background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
        }
        .canvas-result .result-header.success {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
        }
        .canvas-result .result-icon {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .canvas-result .result-header.error .result-icon {
            background: #e53935;
        }
        .canvas-result .result-header.success .result-icon {
            background: #43a047;
        }
        .canvas-result .result-icon svg {
            width: 24px;
            height: 24px;
            fill: #fff;
        }
        .canvas-result .result-title {
            font-size: 16px;
            font-weight: 700;
        }
        .canvas-result .result-header.error .result-title { color: #b71c1c; }
        .canvas-result .result-header.success .result-title { color: #1b5e20; }
        .canvas-result .result-body {
            padding: 16px 20px;
        }
        .canvas-result .result-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 13px;
        }
        .canvas-result .result-row:last-child { border-bottom: none; }
        .canvas-result .result-label { color: #8899aa; }
        .canvas-result .result-value { color: #1a2a4a; font-weight: 500; }
        .canvas-result .result-value.error { color: #e53935; }
        .canvas-result .result-actions {
            padding: 16px 20px;
            background: #fafafa;
            display: flex;
            gap: 10px;
        }
        .canvas-result .btn-canvas {
            flex: 1;
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }
        .canvas-result .btn-canvas.primary {
            background: linear-gradient(135deg, #c9a961 0%, #a68a3a 100%);
            color: #1a2a4a;
        }
        .canvas-result .btn-canvas.primary:hover {
            box-shadow: 0 4px 16px rgba(201, 169, 97, 0.4);
            transform: translateY(-1px);
        }
        .canvas-result .btn-canvas.secondary {
            background: #f5f5f5;
            color: #555;
        }
        .canvas-result .btn-canvas.secondary:hover {
            background: #eee;
        }

        /* ÊîæÂ§ßÊó∂ÁöÑËÉåÊôØÈÅÆÁΩ© */
        .ai-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.25s ease;
        }

        .ai-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .ai-messages {
            flex: 1;
            min-height: 0;
            overflow-y: auto;
            padding: 15px;
            background: #f8f9fa;
        }

        .ai-messages.hidden {
            display: none;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
        }

        .message.user {
            align-items: flex-end;
        }

        .message.ai {
            align-items: flex-start;
        }

        .message-bubble {
            max-width: 85%;
            padding: 12px 15px;
            border-radius: 12px;
            font-size: 14px;
            line-height: 1.5;
        }

        .message.user .message-bubble {
            background: linear-gradient(135deg, #c9a961 0%, #a68a3a 100%);
            color: #1a2a4a;
            border-bottom-right-radius: 4px;
        }

        .message.ai .message-bubble {
            background: #ffffff;
            color: #333;
            border: 1px solid #e0e0e0;
            border-bottom-left-radius: 4px;
        }

        /* AIÊ∂àÊÅØÊ∞îÊ≥°ÂÆπÂô® */
        .message.ai .bubble-wrapper {
            position: relative;
            max-width: 85%;
        }

        .message.ai .bubble-wrapper .message-bubble {
            max-width: 100%;
        }

        /* Ëµû/Ë∏©ÊåâÈíÆ - Âú®Ê∂àÊÅØÊ°ÜÂ§ñÈÉ®Âè≥‰∏ãËßí */
        .feedback-btns {
            position: absolute;
            right: 0;
            top: calc(100% + 4px);
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .message.ai .bubble-wrapper:hover .feedback-btns {
            opacity: 1;
        }

        .feedback-btn {
            width: 24px;
            height: 24px;
            border: none;
            background: rgba(0,0,0,0.05);
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .feedback-btn:hover {
            background: rgba(0,0,0,0.1);
        }

        .feedback-btn svg {
            width: 14px;
            height: 14px;
            fill: #999;
        }

        .feedback-btn:hover svg {
            fill: #666;
        }

        .feedback-btn.active svg {
            fill: #1a73e8;
        }

        .feedback-btn.active.dislike svg {
            fill: #e53935;
        }

        .message-time {
            font-size: 11px;
            color: #999;
            margin-top: 5px;
        }

        /* Êñ∞‰ºöËØùÂàÜÈöîÁ∫ø */
        .new-session-divider {
            display: flex;
            align-items: center;
            margin: 20px 0;
            color: #999;
            font-size: 12px;
        }

        .new-session-divider::before,
        .new-session-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: #ddd;
        }

        .new-session-divider span {
            padding: 0 12px;
            white-space: nowrap;
        }

        /* Êï∞ÊçÆÂç°Áâá */
        .data-card {
            background: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-top: 10px;
            overflow: hidden;
        }

        .data-card-header {
            background: #f5f5f5;
            padding: 10px 12px;
            font-size: 13px;
            color: #666;
            border-bottom: 1px solid #e0e0e0;
        }

        .data-card table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        .data-card th {
            background: #1a2a4a;
            color: #c9a961;
            padding: 8px 10px;
            text-align: left;
        }

        .data-card td {
            padding: 8px 10px;
            border-bottom: 1px solid #eee;
        }

        .data-card tr:last-child td {
            border-bottom: none;
        }

        .data-card-actions {
            padding: 8px 12px;
            background: #f9f9f9;
            display: flex;
            gap: 10px;
        }

        .data-card-actions button {
            font-size: 12px;
            padding: 4px 10px;
            background: none;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            color: #666;
        }

        .data-card-actions button:hover {
            background: #f0f0f0;
        }

        /* ÂºïÁî®Ê†áÊ≥® */
        .reference {
            font-size: 12px;
            color: #888;
            margin-top: 12px;
            padding-top: 10px;
            border-top: 1px solid #eee;
            line-height: 1.8;
        }

        .reference-item {
            display: block;
            color: #666;
        }

        .reference a {
            color: #1a2a4a;
            text-decoration: none;
        }

        .reference a:hover {
            text-decoration: underline;
        }

        /* Êó†Ê≥ïÂõûÁ≠îÊ†∑Âºè */
        .unable-to-answer {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            background: #fffbf0;
            border: 1px solid #ffe7ba;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 4px;
        }

        .unable-icon {
            flex-shrink: 0;
            margin-top: 2px;
        }

        .unable-text {
            color: #8a6d3b;
            font-size: 14px;
            line-height: 1.5;
        }

        /* ÊîπÂÜôÂª∫ËÆÆ */
        .ai-suggestions {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 10px 12px;
        }

        .suggestion-item {
            color: #555;
            font-size: 13px;
            line-height: 1.8;
        }

        /* ÈáçËØïÊåâÈíÆ */
        .retry-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            margin-left: 6px;
            padding: 0;
            background: transparent;
            border: none;
            color: #999;
            cursor: pointer;
            transition: all 0.2s;
            vertical-align: middle;
        }

        .retry-btn:hover {
            color: #666;
        }

        .message-time {
            display: flex;
            align-items: center;
        }

        /* Êé®ËçêÈóÆÈ¢ò */
        .suggested-questions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .suggested-question {
            display: inline-block;
            padding: 6px 12px;
            background: #f0f7ff;
            border: 1px solid #d0e5ff;
            border-radius: 16px;
            color: #1a73e8;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .suggested-question:hover {
            background: #e0efff;
            border-color: #1a73e8;
        }

        /* Ê≠£Êñá‰∏≠ÁöÑÂºïÁî®Â∫èÂè∑ */
        .cite {
            color: #1a73e8;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
        }

        .cite:hover {
            text-decoration: underline;
        }

        /* Âø´Êç∑ÊèêÁ§∫ */
        .quick-prompts {
            padding: 10px 15px;
            background: #f0f0f0;
            border-top: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quick-prompts-title {
            font-size: 12px;
            color: #888;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .quick-prompts-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            flex: 1;
        }

        .quick-prompt {
            font-size: 12px;
            padding: 6px 12px;
            background: #ffffff;
            border: 1px solid #d0d0d0;
            border-radius: 15px;
            cursor: pointer;
            color: #555;
            transition: all 0.2s;
        }

        .quick-prompt:hover {
            background: #c9a961;
            border-color: #c9a961;
            color: #1a2a4a;
        }

        /* Â∑•ÂÖ∑ËèúÂçï */
        .ai-tools-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #f5f5f5;
            border: 1px solid #e0e0e0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        .ai-tools-btn:hover {
            background: #ebebeb;
            border-color: #ccc;
        }
        .ai-tools-btn.active {
            background: linear-gradient(135deg, #4F46E5, #7C3AED);
            border-color: #4F46E5;
        }
        .ai-tools-btn svg {
            width: 20px;
            height: 20px;
            fill: #666;
            transition: all 0.3s;
        }
        .ai-tools-btn.active svg {
            fill: white;
            transform: rotate(45deg);
        }
        .ai-tools-menu {
            position: absolute;
            bottom: 100%;
            left: 0;
            margin-bottom: 8px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            padding: 8px;
            display: none;
            min-width: 160px;
            z-index: 100;
        }
        .ai-tools-menu.show {
            display: block;
            animation: fadeInUp 0.2s ease;
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .ai-tools-menu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s;
            font-size: 14px;
            color: #333;
            font-weight: 500;
            white-space: nowrap;
        }
        .ai-tools-menu-item:hover {
            background: linear-gradient(135deg, #f0f4ff 0%, #fff0f8 100%);
            color: #6b4fbb;
        }
        .ai-tools-menu-item .tool-icon {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }
        .ai-tools-menu-item:nth-child(1) .tool-icon {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
        }
        .ai-tools-menu-item:nth-child(2) .tool-icon {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        }

        /* ÂàùÂßãÊ¨¢ËøéÈ°µÈù¢ */
        .ai-welcome {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 30px;
            background: #f8f9fa;
            text-align: center;
        }

        .ai-welcome.hidden {
            display: none;
        }

        .ai-welcome-icon {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, #c9a961 0%, #a68a3a 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }

        .ai-welcome-icon svg {
            width: 32px;
            height: 32px;
            fill: #1a2a4a;
        }

        .ai-welcome-title {
            font-size: 20px;
            color: #c9a961;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .ai-welcome-subtitle {
            font-size: 14px;
            color: #666;
            margin-bottom: 30px;
        }

        .ai-welcome-prompts {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
            max-width: 320px;
        }

        .ai-welcome-prompt {
            padding: 14px 20px;
            background: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            color: #333;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }

        .ai-welcome-prompt:hover {
            border-color: #c9a961;
            background: linear-gradient(135deg, rgba(201,169,97,0.1) 0%, rgba(166,138,58,0.1) 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        /* ËæìÂÖ•Âå∫Âüü */
        .ai-input-area {
            padding: 15px;
            background: #ffffff;
            border-top: 1px solid #e0e0e0;
        }

        .ai-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .ai-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 14px;
            resize: none;
            outline: none;
            min-height: 44px;
            max-height: 120px;
            font-family: inherit;
        }

        .ai-input:focus {
            border-color: #c9a961;
        }

        .ai-send {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, #1a2a4a 0%, #2a3a5a 100%);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ai-send svg {
            width: 20px;
            height: 20px;
            fill: #c9a961;
        }

        .ai-send:hover {
            background: linear-gradient(135deg, #2a3a5a 0%, #3a4a6a 100%);
        }
    </style>
</head>
<body>
    <!-- ‰∏ªÂÜÖÂÆπÂå∫ iframe -->
    <iframe id="mainFrame" class="main-frame" src="main.html"></iframe>

    <!-- ÈÄöÁü•Èù¢ÊùøÔºàÂç†‰ΩçÔºöÁî®‰∫éÈÇÆ‰ª∂ÈÄöÁü•/ËßÑÂàôÈÖçÁΩÆÂÖ•Âè£Ôºâ -->
    <div class="notify-panel" id="notifyPanel">
        <div class="notify-header">
            <div class="title">ÈÄöÁü•</div>
            <button onclick="openNotifySettings()">ÈÄöÁü•ËÆæÁΩÆ</button>
        </div>
        <div class="notify-controls">
            <button class="notify-seg" id="notifyFilterAll" onclick="setNotifyFilter('all')">ÂÖ®ÈÉ®</button>
            <button class="notify-seg active" id="notifyFilterUnread" onclick="setNotifyFilter('unread')">Êú™ËØª</button>
            <div class="spacer"></div>
            <button class="notify-link" onclick="markAllRead()">ÂÖ®ÈÉ®Â∑≤ËØª</button>
        </div>
        <div class="notify-list" id="notifyList"></div>
    </div>

    <!-- ÈÄöÁü•ËØ¶ÊÉÖÂºπÁ™óÔºàÁÇπÂáªÂçïÊù°ÈÄöÁü•ÂêéÊâìÂºÄÔºå‰∏çÁõ¥Êé•Ë∑≥ËΩ¨Ôºâ -->
    <div class="notify-detail-overlay" id="notifyDetailOverlay" onclick="closeNotifyDetail()">
        <div class="notify-detail-modal" role="dialog" aria-modal="true" onclick="event.stopPropagation()">
            <div class="notify-detail-header">
                <div class="title">ÈÄöÁü•ËØ¶ÊÉÖ</div>
                <button class="notify-detail-close" onclick="closeNotifyDetail()" aria-label="ÂÖ≥Èó≠">√ó</button>
            </div>
            <div class="notify-detail-body">
                <div class="notify-detail-badges">
                    <span class="notify-pill" id="notifyDetailModule">-</span>
                    <span class="notify-level info" id="notifyDetailLevel">ÊèêÁ§∫</span>
                    <span class="notify-detail-time" id="notifyDetailTime">-</span>
                </div>
                <div class="notify-detail-title" id="notifyDetailTitle">-</div>
                <div class="notify-detail-meta" id="notifyDetailMeta">-</div>
            </div>
            <div class="notify-detail-actions">
                <button class="btn-secondary" onclick="closeNotifyDetail()">ÂÖ≥Èó≠</button>
                <button class="btn-primary" id="notifyDetailGoBtn" onclick="goNotifyDetailTarget()">ÂâçÂæÄÁúãÊùø</button>
            </div>
        </div>
    </div>

    <!-- ÊîæÂ§ßÊó∂ÁöÑËÉåÊôØÈÅÆÁΩ© -->
    <div class="ai-overlay" id="aiOverlay" onclick="toggleExpand()"></div>

    <!-- AIÂä©ÊâãÊµÆÂä®Èù¢Êùø -->
    <div class="ai-panel" id="aiPanel">
        <div class="ai-header">
            <h3>
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg>
                HostPilot
            </h3>
            <div class="ai-header-btns">
                <button class="ai-expand" id="aiExpandBtn" onclick="toggleExpand()" title="ÊîæÂ§ß/Áº©Â∞è">
                    <svg id="expandIcon" viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>
                    <svg id="shrinkIcon" viewBox="0 0 24 24" width="18" height="18" fill="currentColor" style="display:none"><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/></svg>
                </button>
                <button class="ai-close" onclick="toggleAI()">√ó</button>
            </div>
        </div>

        <!-- Canvas + Chat ÂèåÂå∫Â∏ÉÂ±Ä -->
        <div class="ai-panel-body">
            <!-- Â∑¶‰æß Canvas Âå∫ÂüüÔºàArtifactsÔºâ -->
            <div class="ai-canvas" id="aiCanvas">
                <div class="ai-canvas-header">
                    <div class="title">
                        <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 14H4V6h16v12zM6 10h2v2H6zm0 4h8v2H6zm10 0h2v2h-2zm-6-4h8v2h-8z"/></svg>
                        Èó®Âç°ËØäÊñ≠
                    </div>
                    <button class="ai-canvas-close" onclick="closeCanvas()" title="ÂÖ≥Èó≠">√ó</button>
                </div>
                <div class="ai-canvas-content">
                    <!-- Èò∂ÊÆµ1ÔºöÂæÖÊú∫ -->
                    <div class="canvas-stage canvas-waiting active" id="canvasWaiting">
                        <div class="card-icon">
                            <svg viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 14H4V6h16v12z"/></svg>
                        </div>
                        <div class="hint">ËØ∑ÊîæÂç°</div>
                        <div class="sub-hint">Â∞ÜÈó®Âç°ÊîæÁΩÆÂú®Âà∂Âç°Êú∫‰∏ä</div>
                    </div>
                    <!-- Èò∂ÊÆµ2ÔºöÂàÜÊûê‰∏≠ -->
                    <div class="canvas-stage canvas-analyzing" id="canvasAnalyzing">
                        <div class="scan-animation">
                            <div class="scan-card"></div>
                            <div class="scan-line"></div>
                        </div>
                        <div class="status-text">Ê≠£Âú®ÂàÜÊûêÂç°Áâá...</div>
                        <div class="analyzing-steps">
                            <div class="step-item" id="step1">
                                <span class="step-icon loading"></span>
                                <span>ËØªÂèñÂç°Áâá‰ø°ÊÅØ</span>
                            </div>
                            <div class="step-item" id="step2">
                                <span class="step-icon"></span>
                                <span>Êü•ËØ¢Á≥ªÁªüËÆ∞ÂΩï</span>
                            </div>
                            <div class="step-item" id="step3">
                                <span class="step-icon"></span>
                                <span>Ê£ÄÊü•Èó®ÈîÅÁä∂ÊÄÅ</span>
                            </div>
                            <div class="step-item" id="step4">
                                <span class="step-icon"></span>
                                <span>ÂàÜÊûêËØäÊñ≠ÁªìÊûú</span>
                            </div>
                        </div>
                    </div>
                    <!-- Èò∂ÊÆµ3ÔºöÁªìÊûú -->
                    <div class="canvas-stage canvas-result" id="canvasResult">
                        <div class="result-card">
                            <div class="result-header error" id="resultHeader">
                                <div class="result-icon">
                                    <svg viewBox="0 0 24 24" id="resultIconSvg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                                </div>
                                <div class="result-title" id="resultTitle">Âç°ÁâáÂ∑≤ËøáÊúü</div>
                            </div>
                            <div class="result-body" id="resultBody">
                                <div class="result-row">
                                    <span class="result-label">ÊàøÈó¥Âè∑</span>
                                    <span class="result-value" id="resRoom">1208</span>
                                </div>
                                <div class="result-row">
                                    <span class="result-label">Âç°Á±ªÂûã</span>
                                    <span class="result-value" id="resType">ÂÆæÂÆ¢Âç°</span>
                                </div>
                                <div class="result-row">
                                    <span class="result-label">ÊúâÊïàÊúüËá≥</span>
                                    <span class="result-value error" id="resExpiry">12-12 12:00 (Â∑≤ËøáÊúü)</span>
                                </div>
                                <div class="result-row">
                                    <span class="result-label">Èó®ÈîÅÁä∂ÊÄÅ</span>
                                    <span class="result-value" id="resLock">Âú®Á∫ø</span>
                                </div>
                            </div>
                            <div class="result-actions">
                                <button class="btn-canvas secondary" onclick="resetCanvas()">ÈáçÊñ∞ÂàÜÊûê</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Â∫ïÈÉ®ÊºîÁ§∫Âú∫ÊôØÂå∫ -->
                <div class="demo-scenarios">
                    <div class="demo-title">ÊºîÁ§∫Âú∫ÊôØ</div>
                    <div class="demo-buttons">
                        <div class="demo-row">
                            <button class="demo-btn error" onclick="simulateScenario('expired')">üî¥ Âç°ÁâáÂ∑≤ËøáÊúü</button>
                            <button class="demo-btn error" onclick="simulateScenario('lost')">üî¥ Âç°ÁâáÂ∑≤ÊåÇÂ§±</button>
                            <button class="demo-btn error" onclick="simulateScenario('replaced')">üî¥ ÊóßÂç°Ë¢´ÊõøÊç¢</button>
                        </div>
                        <div class="demo-row">
                            <button class="demo-btn warning" onclick="simulateScenario('offline')">üü° Èó®ÈîÅÁ¶ªÁ∫ø</button>
                            <button class="demo-btn warning" onclick="simulateScenario('lowbattery')">üü° ‰ΩéÁîµÈáè</button>
                            <button class="demo-btn warning" onclick="simulateScenario('syncpending')">üü° ÂêåÊ≠•‰∏≠</button>
                            <button class="demo-btn success" onclick="simulateScenario('normal')">üü¢ Ê≠£Â∏∏</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Âè≥‰æßÂØπËØùÂå∫Âüü -->
            <div class="ai-chat-area">
        <!-- ÂàùÂßãÊ¨¢ËøéÈ°µÈù¢ -->
        <div class="ai-welcome" id="aiWelcome">
            <div class="ai-welcome-icon">
                <svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg>
            </div>
            <div class="ai-welcome-title">‰Ω†Â•ΩÔºÅÊàëÊòØ HostPilot</div>
            <div class="ai-welcome-subtitle">ÊàëÂèØ‰ª•Â∏ÆÊÇ®Ëß£Á≠îÂÖ≥‰∫éÈó®ÈîÅÁ≥ªÁªüÁöÑÈóÆÈ¢ò</div>
            <div class="ai-welcome-prompts">
                <div class="ai-welcome-prompt" onclick="startChat('‰ªäÊó•ÂÖ•‰ΩèÊÉÖÂÜµÂ¶Ç‰ΩïÔºü')">üìä ‰ªäÊó•ÂÖ•‰ΩèÊÉÖÂÜµÂ¶Ç‰ΩïÔºü</div>
                <div class="ai-welcome-prompt" onclick="startChat('Êü•Áúã‰∏ä‰∏™ÊúàÁöÑÊä•Ë°®Êï∞ÊçÆ')">üìà Êü•Áúã‰∏ä‰∏™ÊúàÁöÑÊä•Ë°®Êï∞ÊçÆ</div>
                <div class="ai-welcome-prompt" onclick="startChat('‰∫åÁª¥Á†ÅÂºÄÈó®ÊÄé‰πàËÆæÁΩÆÔºü')">üîê ‰∫åÁª¥Á†ÅÂºÄÈó®ÊÄé‰πàËÆæÁΩÆÔºü</div>
            </div>
        </div>

        <!-- ÂØπËØùÊ∂àÊÅØÂå∫Âüü -->
        <div class="ai-messages hidden" id="aiMessages">
            <div class="message ai">
                <div class="bubble-wrapper">
                    <div class="message-bubble">
                        ‰Ω†Â•ΩÔºÅÊàëÊòØÈó®ÈîÅÁ≥ªÁªüAIÂä©ÊâãÔºåÂèØ‰ª•Â∏Æ‰Ω†Ôºö
                        <br>‚Ä¢ Êü•ËØ¢ÂºÄÈó®ËÆ∞ÂΩïÂíåÊä•Ë°®Êï∞ÊçÆ
                        <br>‚Ä¢ Ëß£Á≠îÈó®ÈîÅÊìç‰ΩúÁõ∏ÂÖ≥ÈóÆÈ¢ò
                        <br>‚Ä¢ ÁîüÊàêÊï∞ÊçÆÂàÜÊûêÊä•Âëä
                        <br><br>ËØ∑ÈóÆÊúâ‰ªÄ‰πàÂèØ‰ª•Â∏Æ‰Ω†ÁöÑÔºü
                    </div>
                    <div class="feedback-btns">
                        <button class="feedback-btn like" onclick="handleFeedback(this, 'like')" title="ÊúâÂ∏ÆÂä©">
                            <svg viewBox="0 0 24 24"><path d="M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2z"/></svg>
                        </button>
                        <button class="feedback-btn dislike" onclick="handleFeedback(this, 'dislike')" title="Ê≤°Â∏ÆÂä©">
                            <svg viewBox="0 0 24 24"><path d="M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2zm4 0v12h4V3h-4z"/></svg>
                        </button>
                    </div>
                </div>
                <div class="message-time">17:06</div>
            </div>

            <div class="message user">
                <div class="message-bubble">
                    ÊúÄËøë7Â§©ÂºÄÈó®Â§±Ë¥•ÁéáÊúÄÈ´òÁöÑÊàøÈó¥ÊúâÂì™‰∫õÔºü
                </div>
                <div class="message-time">17:07</div>
            </div>

            <div class="message ai">
                <div class="bubble-wrapper">
                    <div class="message-bubble">
                        Ê†πÊçÆÊúÄËøë7Â§©ÁöÑÊï∞ÊçÆÔºåÂºÄÈó®Â§±Ë¥•ÁéáÊúÄÈ´òÁöÑÊàøÈó¥Â¶Ç‰∏ãÔºö
                        
                        <div class="data-card">
                            <div class="data-card-header">üìä Ëøë7Â§©ÂºÄÈó®Â§±Ë¥•Áéá Top 5Ôºà2025/11/22 - 11/28Ôºâ</div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>ÊàøÈó¥Âè∑</th>
                                        <th>Â∞ùËØïÊ¨°Êï∞</th>
                                        <th>Â§±Ë¥•Ê¨°Êï∞</th>
                                        <th>Â§±Ë¥•Áéá</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td>1208</td><td>45</td><td>8</td><td style="color:#e53935">17.8%</td></tr>
                                    <tr><td>0915</td><td>38</td><td>5</td><td style="color:#e53935">13.2%</td></tr>
                                    <tr><td>0703</td><td>52</td><td>6</td><td style="color:#ff9800">11.5%</td></tr>
                                    <tr><td>1105</td><td>41</td><td>4</td><td style="color:#ff9800">9.8%</td></tr>
                                    <tr><td>0812</td><td>33</td><td>3</td><td style="color:#ff9800">9.1%</td></tr>
                                </tbody>
                            </table>
                            <div class="data-card-actions">
                                <button>ÂØºÂá∫ CSV</button>
                                <button>Êü•ÁúãËØ¶ÊÉÖ</button>
                            </div>
                        </div>

                        <br>1208ÊàøÈó¥Â§±Ë¥•ÁéáÊúÄÈ´òÔºå‰∏ªË¶ÅÂéüÂõ†ÊòØ„ÄåÂç°ÁâáËØªÂèñÂ§±Ë¥•„ÄçÔºà5Ê¨°ÔºâÂíå„ÄåÈó®ÈîÅÈÄö‰ø°Ë∂ÖÊó∂„ÄçÔºà3Ê¨°ÔºâÔºåÂª∫ËÆÆÊ£ÄÊü•ËØ•ÊàøÈó¥Èó®ÈîÅËÆæÂ§áÁä∂ÊÄÅ„ÄÇ
                    </div>
                    <div class="feedback-btns">
                        <button class="feedback-btn like" onclick="handleFeedback(this, 'like')" title="ÊúâÂ∏ÆÂä©">
                            <svg viewBox="0 0 24 24"><path d="M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2z"/></svg>
                        </button>
                        <button class="feedback-btn dislike" onclick="handleFeedback(this, 'dislike')" title="Ê≤°Â∏ÆÂä©">
                            <svg viewBox="0 0 24 24"><path d="M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2zm4 0v12h4V3h-4z"/></svg>
                        </button>
                    </div>
                </div>
                <div class="message-time">17:07</div>
            </div>

            <!-- Êñ∞‰ºöËØùÂàÜÈöîÁ∫ø -->
            <div class="new-session-divider">
                <span>‰ª•‰∏ã‰∏∫Êñ∞‰ºöËØù</span>
            </div>

            <div class="message user">
                <div class="message-bubble">
                    Èó®ÈîÅÁîµÊ±†Â§ö‰πÖÈúÄË¶ÅÊõ¥Êç¢Ôºü
                </div>
                <div class="message-time">17:08</div>
            </div>

            <div class="message ai">
                <div class="bubble-wrapper">
                    <div class="message-bubble">
                        Èó®ÈîÅÁîµÊ±†Êõ¥Êç¢Âë®ÊúüÂèñÂÜ≥‰∫é‰ΩøÁî®È¢ëÁéá <span class="cite">[1]</span>Ôºö

                        <br><br>‚Ä¢ <b>ÊôÆÈÄöÊàøÈó¥</b>ÔºöÁ∫¶ 12-18 ‰∏™Êúà <span class="cite">[1]</span>
                        <br>‚Ä¢ <b>È´òÈ¢ë‰ΩøÁî®ÊàøÈó¥</b>ÔºàÂ¶Ç‰ºöËÆÆÂÆ§„ÄÅÂÖ¨ÂÖ±Âå∫ÂüüÔºâÔºöÁ∫¶ 8-12 ‰∏™Êúà <span class="cite">[1]</span>
                        
                        <br><br><b>‰ΩéÁîµÈáèÈ¢ÑË≠¶</b>ÔºöÂΩìÁîµÈáè‰Ωé‰∫é 20% Êó∂ÔºåÁ≥ªÁªü‰ºöËá™Âä®ÂèëÂá∫ÂëäË≠¶ <span class="cite">[2]</span>ÔºåÂª∫ËÆÆÂú®Êî∂Âà∞ÂëäË≠¶Âêé 7 Â§©ÂÜÖÊõ¥Êç¢„ÄÇ

                        <br><br><b>Êõ¥Êç¢Ê≠•È™§</b> <span class="cite">[3]</span>Ôºö
                        <br>1. ‰ΩøÁî®ÁÆ°ÁêÜÂç°ÂºÄÈó®
                        <br>2. ÊâìÂºÄÈó®ÈîÅÂÜÖ‰æßÁîµÊ±†Áõñ
                        <br>3. ÂèñÂá∫ÊóßÁîµÊ±†ÔºåË£ÖÂÖ•4ËäÇÊñ∞5Âè∑ÁîµÊ±†
                        <br>4. ÁõñÂ•ΩÁîµÊ±†ÁõñÔºåÁî®ÁÆ°ÁêÜÂç°ÊµãËØïÂºÄÈó®

                        <div class="reference">
                            <span class="reference-item"><b>[1]</b> „ÄäÈó®ÈîÅÁª¥Êä§ÊâãÂÜå„Äã v2.1; 2025/6/15; Á¨¨3Á´† ÁîµÊ±†Êõ¥Êç¢</span>
                            <span class="reference-item"><b>[2]</b> „ÄäÁ≥ªÁªüÂëäË≠¶ÈÖçÁΩÆÊåáÂçó„Äã v1.3; 2025/8/20; Á¨¨5ËäÇ ‰ΩéÁîµÈáèÈ¢ÑË≠¶</span>
                            <span class="reference-item"><b>[3]</b> „ÄäÈó®ÈîÅÂÆâË£ÖÊåáÂçó„Äã v1.0; 2025/5/10; Á¨¨7Á´† Êó•Â∏∏Áª¥Êä§</span>
                        </div>
                    </div>
                    <div class="feedback-btns">
                        <button class="feedback-btn like" onclick="handleFeedback(this, 'like')" title="ÊúâÂ∏ÆÂä©">
                            <svg viewBox="0 0 24 24"><path d="M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2z"/></svg>
                        </button>
                        <button class="feedback-btn dislike" onclick="handleFeedback(this, 'dislike')" title="Ê≤°Â∏ÆÂä©">
                            <svg viewBox="0 0 24 24"><path d="M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2zm4 0v12h4V3h-4z"/></svg>
                        </button>
                    </div>
                </div>
                <div class="message-time">17:08</div>
            </div>

            <!-- Áî®Êà∑ÈóÆÈ¢òÔºöÊó†Ê≥ïÂõûÁ≠îÂú∫ÊôØ -->
            <div class="message user">
                <div class="message-bubble">ÊÄé‰πàËøõÂÖ•ÂÅ•Ë∫´ÊàøÔºü</div>
                <div class="message-time">17:10</div>
            </div>

            <!-- AIÂõûÂ§çÔºöÊó†ÂëΩ‰∏≠ÊèêÁ§∫ + ÊîπÂÜôÂª∫ËÆÆ -->
            <div class="message ai">
                <div class="bubble-wrapper">
                    <div class="message-bubble">
                        <div class="unable-to-answer">
                            <div class="unable-icon">
                                <svg viewBox="0 0 24 24" width="20" height="20" fill="#f0ad4e"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                            </div>
                            <div class="unable-text">Êä±Ê≠âÔºåÊàëÊó†Ê≥ïÂú®Áü•ËØÜÂ∫ì‰∏≠ÊâæÂà∞ÂÖ≥‰∫é„ÄåÊÄé‰πàËøõÂÖ•ÂÅ•Ë∫´Êàø„ÄçÁöÑÁõ∏ÂÖ≥ÂÜÖÂÆπ„ÄÇ</div>
                        </div>
                        <p style="margin: 12px 0 8px; color: #666; font-size: 13px;">ÊÇ®ÂèØ‰ª•Â∞ùËØïËøôÊ†∑ÈóÆÊàëÔºö</p>
                        <div class="ai-suggestions">
                            <div class="suggestion-item">‚Ä¢ Â¶Ç‰ΩïÁî®ÊàøÂç°ÂºÄÈó®Ôºü</div>
                            <div class="suggestion-item">‚Ä¢ Èó®ÈîÅÁ¶ªÁ∫øÊÄé‰πàÂ§ÑÁêÜÔºü</div>
                            <div class="suggestion-item">‚Ä¢ Êü•Áúã‰ΩéÁîµÈáèÈó®ÈîÅÂàóË°®</div>
                        </div>
                    </div>
                </div>
                <div class="message-time">
                    17:10
                    <button class="retry-btn" onclick="retryLastMessage()" title="ÈáçËØï">
                        <svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Âø´Êç∑ÊèêÁ§∫ -->
        <div class="quick-prompts" style="display: none;">
            <div class="quick-prompts-title">Âø´Êç∑ÊèêÈóÆÔºö</div>
            <div class="quick-prompts-list">
                <span class="quick-prompt" onclick="sendQuickPrompt('‰ªäÊó•ÂÖ•‰ΩèÊÉÖÂÜµ')">‰ªäÊó•ÂÖ•‰ΩèÊÉÖÂÜµ</span>
                <span class="quick-prompt" onclick="sendQuickPrompt('‰ΩéÁîµÈáèÈó®ÈîÅ')">‰ΩéÁîµÈáèÈó®ÈîÅ</span>
                <span class="quick-prompt" onclick="sendQuickPrompt('ÂºÇÂ∏∏ÂºÄÈó®‰∫ã‰ª∂')">ÂºÇÂ∏∏ÂºÄÈó®‰∫ã‰ª∂</span>
                <span class="quick-prompt" onclick="sendQuickPrompt('ÁîüÊàêÊó•Êä•')">ÁîüÊàêÊó•Êä•</span>
            </div>
        </div>

        <!-- ËæìÂÖ•Âå∫Âüü -->
        <div class="ai-input-area">
            <div class="ai-input-wrapper">
                <div class="ai-tools-container" style="position: relative;">
                    <button class="ai-tools-btn" id="aiToolsBtn" onclick="toggleToolsMenu()">
                        <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                    </button>
                    <div class="ai-tools-menu" id="aiToolsMenu">
                        <div class="ai-tools-menu-item" onclick="selectTool('diagnose')">
                            <span class="tool-icon">üîß</span>
                            <span>Èó®Âç°ËØäÊñ≠</span>
                        </div>
                    </div>
                </div>
                <textarea class="ai-input" id="aiInput" placeholder="ËæìÂÖ•ÈóÆÈ¢òÔºåÊåâ Enter ÂèëÈÄÅ..." rows="1" onkeydown="handleKeyDown(event)"></textarea>
                <button class="ai-send" onclick="sendMessage()">
                    <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
                </button>
            </div>
        </div>
            </div><!-- ÂÖ≥Èó≠ ai-chat-area -->
        </div><!-- ÂÖ≥Èó≠ ai-panel-body -->
    </div>

    <!-- Âè≥‰∏ãËßíÊµÆÁ™óÁêÉ -->
    <div class="ai-float-btn" id="aiFloatBtn" onclick="toggleAI()">
        <svg class="icon-chat" viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/><path d="M7 9h2v2H7zm4 0h2v2h-2zm4 0h2v2h-2z"/></svg>
        <svg class="icon-close" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
    </div>

    <script>
        // ÂàáÊç¢ AI Èù¢Êùø
        function toggleAI() {
            const panel = document.getElementById('aiPanel');
            const btn = document.getElementById('aiFloatBtn');
            const isOpen = panel.classList.contains('show');
            
            if (isOpen) {
                panel.classList.remove('show');
                btn.classList.remove('active');
            } else {
                panel.classList.add('show');
                btn.classList.add('active');
                // ÊªöÂä®Âà∞Â∫ïÈÉ®
                const messages = document.getElementById('aiMessages');
                messages.scrollTop = messages.scrollHeight;
            }
        }

        // ÂàáÊç¢ÊîæÂ§ß/Áº©Â∞è
        function toggleExpand() {
            const panel = document.getElementById('aiPanel');
            const overlay = document.getElementById('aiOverlay');
            const expandIcon = document.getElementById('expandIcon');
            const shrinkIcon = document.getElementById('shrinkIcon');
            const isExpanded = panel.classList.contains('expanded');
            
            if (isExpanded) {
                panel.classList.remove('expanded');
                overlay.classList.remove('show');
                expandIcon.style.display = 'block';
                shrinkIcon.style.display = 'none';
            } else {
                panel.classList.add('expanded');
                overlay.classList.add('show');
                expandIcon.style.display = 'none';
                shrinkIcon.style.display = 'block';
            }
        }

        // Â§ÑÁêÜËµû/Ë∏©ÂèçÈ¶à
        function handleFeedback(btn, type) {
            const wrapper = btn.closest('.feedback-btns');
            const likeBtn = wrapper.querySelector('.like');
            const dislikeBtn = wrapper.querySelector('.dislike');
            
            if (type === 'like') {
                if (likeBtn.classList.contains('active')) {
                    likeBtn.classList.remove('active');
                } else {
                    likeBtn.classList.add('active');
                    dislikeBtn.classList.remove('active');
                }
            } else {
                if (dislikeBtn.classList.contains('active')) {
                    dislikeBtn.classList.remove('active');
                } else {
                    dislikeBtn.classList.add('active');
                    likeBtn.classList.remove('active');
                }
            }
        }

        // ========== Â∑•ÂÖ∑ËèúÂçï ==========
        function toggleToolsMenu() {
            const btn = document.getElementById('aiToolsBtn');
            const menu = document.getElementById('aiToolsMenu');
            const isOpen = menu.classList.contains('show');
            
            if (isOpen) {
                menu.classList.remove('show');
                btn.classList.remove('active');
            } else {
                menu.classList.add('show');
                btn.classList.add('active');
            }
        }

        function selectTool(tool) {
            // ÂÖ≥Èó≠ËèúÂçï
            document.getElementById('aiToolsMenu').classList.remove('show');
            document.getElementById('aiToolsBtn').classList.remove('active');
            
            if (tool === 'diagnose') {
                startCardDiagnosis();
            }
        }

        // ÁÇπÂáªÂÖ∂‰ªñÂå∫ÂüüÂÖ≥Èó≠Â∑•ÂÖ∑ËèúÂçï
        document.addEventListener('click', function(e) {
            const toolsContainer = document.querySelector('.ai-tools-container');
            if (toolsContainer && !toolsContainer.contains(e.target)) {
                document.getElementById('aiToolsMenu')?.classList.remove('show');
                document.getElementById('aiToolsBtn')?.classList.remove('active');
            }
        });

        // ========== Artifacts Canvas Èó®Âç°ËØäÊñ≠ÂäüËÉΩ ==========
        
        // ÂºÄÂêØÈó®Âç°ËØäÊñ≠Ôºà‰ªéÊ¨¢ËøéÈ°µÊàñÂØπËØùËß¶ÂèëÔºâ
        function startCardDiagnosis() {
            const panel = document.getElementById('aiPanel');
            const welcome = document.getElementById('aiWelcome');
            const messages = document.getElementById('aiMessages');
            const quickPrompts = document.querySelector('.quick-prompts');
            
            // Á°Æ‰øùÈù¢ÊùøÊâìÂºÄ
            if (!panel.classList.contains('show')) {
                panel.classList.add('show');
                document.getElementById('aiFloatBtn').classList.add('active');
            }
            
            // ÂàáÊç¢Âà∞ÂØπËØùÊ®°Âºè
            welcome.classList.add('hidden');
            messages.classList.remove('hidden');
            if (quickPrompts) quickPrompts.style.display = 'flex';
            
            // ÊâìÂºÄ Canvas
            panel.classList.add('canvas-mode');
            resetCanvasStage('waiting');
            
            // Ê∑ªÂä† AI Ê∂àÊÅØÂºïÂØº
            addMessage('Â•ΩÁöÑÔºåËØäÊñ≠Ê®°ÂºèÂ∑≤ÂºÄÂêØ„ÄÇËØ∑Â∞ÜÈó®Âç°ÊîæÁΩÆÂú®Âà∂Âç°Êú∫‰∏äÔºåÊàë‰ºöÂ∏Æ‰Ω†ÂàÜÊûê„ÄÇ\n\nüí° ‰πüÂèØ‰ª•ÁÇπÂáªÂ∑¶‰æß‚ÄúÊºîÁ§∫Âú∫ÊôØ‚ÄùÂø´ÈÄüÊü•Áúã‰∏çÂêåÈóÆÈ¢òÁ±ªÂûã„ÄÇ', 'ai');
        }
        
        // Âú∫ÊôØÊï∞ÊçÆÈÖçÁΩÆ
        const scenarioData = {
            expired: {
                status: 'error',
                title: 'Âç°ÁâáÂ∑≤ËøáÊúü',
                room: '1208',
                type: 'ÂÆæÂÆ¢Âç°',
                expiry: '12-21 12:00 (Â∑≤ËøáÊúü2Â∞èÊó∂)',
                lockStatus: 'Âú®Á∫ø',
                aiMessage: 'üî¥ ËØäÊñ≠ÂÆåÊàêÔºö**Âç°ÁâáÂ∑≤ËøáÊúü**\n\n- ÊàøÈó¥Âè∑Ôºö1208\n- Âç°Á±ªÂûãÔºöÂÆæÂÆ¢Âç°\n- ËøáÊúüÊó∂Èó¥Ôºö‰ªäÂ§© 12:00ÔºàÂ∑≤ËøáÊúü2Â∞èÊó∂Ôºâ\n\nÂª∫ËÆÆÔºöËØ∑ÂâçÂæÄ„ÄêÂà∂Âç°/ÂèëÂç°„ÄëÊ®°Âùó‰∏∫ÂÆ¢‰∫∫Âª∂ÊúüÊàñÈáçÂà∂Èó®Âç°ÔºåÂπ∂ÈáçÊñ∞È™åËØÅÂºÄÈó®„ÄÇ'
            },
            lost: {
                status: 'error',
                title: 'Âç°ÁâáÂ∑≤ÊåÇÂ§±',
                room: '0815',
                type: 'ÂÆæÂÆ¢Âç°',
                expiry: '12-23 14:00',
                lockStatus: 'Âú®Á∫ø',
                lockStatusClass: '',
                aiMessage: 'üî¥ ËØäÊñ≠ÂÆåÊàêÔºö**Âç°ÁâáÂ∑≤ÊåÇÂ§±**\n\n- ÊàøÈó¥Âè∑Ôºö0815\n- Âç°Á±ªÂûãÔºöÂÆæÂÆ¢Âç°\n- ÊåÇÂ§±Êó∂Èó¥Ôºö‰ªäÂ§© 09:30\n\nÂª∫ËÆÆÔºöÊ≠§Âç°Â∑≤Á¶ÅÁî®ÔºåËØ∑ÂâçÂæÄ„ÄêÂà∂Âç°/ÂèëÂç°„ÄëÊ®°ÂùóÈáçÂà∂Êñ∞Âç°ÔºåÂπ∂ÂõûÊî∂ÊóßÂç°„ÄÇ'
            },
            offline: {
                status: 'warning',
                title: 'Èó®ÈîÅÁ¶ªÁ∫ø',
                room: '0502',
                type: 'ÂÆæÂÆ¢Âç°',
                expiry: '12-22 12:00',
                lockStatus: 'Á¶ªÁ∫ø (2Â∞èÊó∂)',
                lockStatusClass: 'warning',
                aiMessage: 'üü° ËØäÊñ≠ÂÆåÊàêÔºö**Èó®ÈîÅÁ¶ªÁ∫ø**\n\n- ÊàøÈó¥Âè∑Ôºö0502\n- Âç°ÁâáÁä∂ÊÄÅÔºöÊúâÊïà\n- Èó®ÈîÅÁä∂ÊÄÅÔºöÁ¶ªÁ∫øÂ∑≤ 2 Â∞èÊó∂\n\nÂª∫ËÆÆÔºöËØ∑Âú®„ÄêËÆæÂ§áÁÆ°ÁêÜ„ÄëÊ£ÄÊü•Èó®ÈîÅÂú®Á∫øÁä∂ÊÄÅ/ÁΩëÂÖ≥ÈÄö‰ø°ÔºåÂøÖË¶ÅÊó∂ÈÄöÁü•Â∑•Á®ã‰∫∫ÂëòÁé∞Âú∫Â§ÑÁêÜ„ÄÇ'
            },
            lowbattery: {
                status: 'warning',
                title: 'Èó®ÈîÅ‰ΩéÁîµÈáè',
                room: '1015',
                type: 'ÂÆæÂÆ¢Âç°',
                expiry: '12-24 11:00',
                lockStatus: 'ÁîµÈáè 8%',
                lockStatusClass: 'warning',
                aiMessage: 'üü° ËØäÊñ≠ÂÆåÊàêÔºö**Èó®ÈîÅ‰ΩéÁîµÈáè**\n\n- ÊàøÈó¥Âè∑Ôºö1015\n- Âç°ÁâáÁä∂ÊÄÅÔºöÊúâÊïà\n- Èó®ÈîÅÁîµÈáèÔºö8%ÔºàÈúÄÂ∞ΩÂø´Êõ¥Êç¢Ôºâ\n\nÂª∫ËÆÆÔºöÂ∞ΩÂø´Êõ¥Êç¢Èó®ÈîÅÁîµÊ±†Âπ∂Â§çÊµãÔºõÂ¶Ç‰ªçÂ§±Ë¥•ÔºåÂÜçÂ§çÊ†∏Èó®ÈîÅÈÄö‰ø°‰∏éÊùÉÈôêÂêåÊ≠•„ÄÇ'
            },
            normal: {
                status: 'success',
                title: 'Âç°ÁâáÊ≠£Â∏∏',
                room: '0903',
                type: 'ÂÆæÂÆ¢Âç°',
                expiry: '12-25 14:00',
                lockStatus: 'Âú®Á∫øÊ≠£Â∏∏',
                lockStatusClass: 'success',
                aiMessage: 'üü¢ ËØäÊñ≠ÂÆåÊàêÔºö**Âç°ÁâáÊ≠£Â∏∏**\n\n- ÊàøÈó¥Âè∑Ôºö0903\n- Âç°Á±ªÂûãÔºöÂÆæÂÆ¢Âç°\n- ÊúâÊïàÊúüÔºö12-25 14:00\n- Èó®ÈîÅÁä∂ÊÄÅÔºöÂú®Á∫øÊ≠£Â∏∏\n\nÂª∫ËÆÆÔºöÊåáÂØºÂÆ¢‰∫∫Ê≠£Á°ÆÂà∑Âç°/ÊèíÂç°ÔºõÂ¶Ç‰ªçÊó†Ê≥ïÂºÄÈó®ÔºåÂèØÂ∞ùËØïÈáçÂà∂Èó®Âç°Âπ∂ÂÜçÊ¨°È™åËØÅ„ÄÇ'
            },
            replaced: {
                status: 'error',
                title: 'ÊóßÂç°Â∑≤Ë¢´ÊõøÊç¢',
                room: '0712',
                type: 'ÂÆæÂÆ¢Âç°',
                expiry: 'Â∑≤Â§±Êïà',
                lockStatus: 'Âú®Á∫ø',
                lockStatusClass: '',
                aiMessage: 'üî¥ ËØäÊñ≠ÂÆåÊàêÔºö**ÊóßÂç°Â∑≤Ë¢´ÊõøÊç¢**\n\n- ÊàøÈó¥Âè∑Ôºö0712\n- ÂΩìÂâçÂç°ÔºöÂ∑≤Â§±ÊïàÔºàË¢´Êñ∞Âç°Ë¶ÜÁõñÔºâ\n- ÊúÄÊñ∞Âà∂Âç°Ôºö‰ªäÂ§© 10:32ÔºàÊìç‰ΩúÂëòÔºöÂº†ÂâçÂè∞Ôºâ\n\n**ËØÅÊçÆ**ÔºöÂêå‰∏ÄÊàøÈó¥Âú® 10:32 ÂèàÂà∂‰Ωú‰∫Ü‰∏ÄÂº†Êñ∞Âç°ÔºåÁ≥ªÁªüËÆæÁΩÆ‰∏∫"Ë°•Âç°ÁªàÊ≠¢ÊóßÂç°"ÔºåÂõ†Ê≠§ÊóßÂç°Â∑≤Â§±Êïà„ÄÇ\n\nÂª∫ËÆÆÔºöËØ∑Ê†∏ÂØπÂÆ¢‰∫∫Êâã‰∏≠Âç°ÁâáÊòØÂê¶‰∏∫ÊúÄÊñ∞Âà∂‰ΩúÁöÑÈÇ£Âº†ÔºàÊåâÂà∂Âç°Êó∂Èó¥/Âç°Âè∑Ê†∏ÂØπÔºâÔºõÁ°ÆËÆ§ÂêéÂõûÊàøÈáçËØï„ÄÇ'
            },
            syncpending: {
                status: 'warning',
                title: 'ÊùÉÈôêÂêåÊ≠•‰∏≠',
                room: '0318',
                type: 'ÂÆæÂÆ¢Âç°',
                expiry: '12-24 12:00',
                lockStatus: 'ZigBee ÂêåÊ≠•‰∏≠',
                lockStatusClass: 'warning',
                aiMessage: 'üü° ËØäÊñ≠ÂÆåÊàêÔºö**ÊùÉÈôêÂêåÊ≠•Âª∂Ëøü**\n\n- ÊàøÈó¥Âè∑Ôºö0318\n- Âç°ÁâáÁä∂ÊÄÅÔºöÊúâÊïà\n- Èó®ÈîÅÁä∂ÊÄÅÔºöZigBee Âú®Á∫ø\n- ‰∏ãÂèëÈòüÂàóÔºöÂ≠òÂú®Êú™ÂÆåÊàêÂëΩ‰ª§\n\n**ËØÅÊçÆ**ÔºöÁ≥ªÁªüÊ£ÄÊµãÂà∞‰ªçÊúâÊú™ÂÆåÊàêÁöÑ‰∏ãÂèëÂëΩ‰ª§ÔºàÈòüÂàóÁßØÂéãÔºâÔºåÂèØËÉΩÂØºËá¥Èó®ÈîÅÁ´ØÊùÉÈôêÂ∞öÊú™Êõ¥Êñ∞„ÄÇ\n\nÂª∫ËÆÆÔºöËØ∑Á®çÁ≠â 1-2 ÂàÜÈíüÂêéËÆ©ÂÆ¢‰∫∫ÈáçËØïÔºõÂ¶Ç‰ªçÂ§±Ë¥•ÔºåÂú®„ÄêËÆæÂ§áÁÆ°ÁêÜ„ÄëÁ°ÆËÆ§ÁΩëÂÖ≥/Èó®ÈîÅÂú®Á∫øÁä∂ÊÄÅÔºåÊÅ¢Â§çÈìæË∑ØÂêéÁÇπÂáª"ÈáçÊñ∞ÂàÜÊûê"È™åËØÅ„ÄÇ‰∏çÂª∫ËÆÆÂèçÂ§çÈáçÂà∂Âç°ÔºàÂèØËÉΩËß¶ÂèëÊóßÂç°Â§±ÊïàÔºåÈóÆÈ¢òÊõ¥Â§çÊùÇÔºâ„ÄÇ'
            }
        };
        
        // ÁÇπÂáªÊºîÁ§∫Âú∫ÊôØÊåâÈíÆ
        function simulateScenario(scenario) {
            resetCanvasStage('analyzing');
            
            // ÈáçÁΩÆÊ≠•È™§Áä∂ÊÄÅ
            for (let i = 1; i <= 4; i++) {
                const step = document.getElementById('step' + i);
                step.classList.remove('active', 'done');
            }
            
            // ÈÄêÊ≠•ÊâßË°åÂä®Áîª
            let stepIndex = 0;
            const runStep = () => {
                if (stepIndex < 4) {
                    // ÂΩìÂâçÊ≠•È™§ËÆæ‰∏∫active
                    const currentStep = document.getElementById('step' + (stepIndex + 1));
                    currentStep.classList.add('active');
                    
                    setTimeout(() => {
                        // ÂΩìÂâçÊ≠•È™§ÂÆåÊàê
                        currentStep.classList.remove('active');
                        currentStep.classList.add('done');
                        stepIndex++;
                        runStep();
                    }, 600);
                } else {
                    // ÂÖ®ÈÉ®ÂÆåÊàêÔºåÊòæÁ§∫ÁªìÊûú
                    setTimeout(() => {
                        showDiagnosisResult(scenario);
                    }, 300);
                }
            };
            runStep();
        }
        
        // ÂÖ≥Èó≠ Canvas
        function closeCanvas() {
            const panel = document.getElementById('aiPanel');
            panel.classList.remove('canvas-mode');
        }
        
        // ÈáçÁΩÆ Canvas Âà∞ÊåáÂÆöÈò∂ÊÆµ
        function resetCanvasStage(stage) {
            const stages = ['canvasWaiting', 'canvasAnalyzing', 'canvasResult'];
            stages.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.classList.remove('active');
            });
            const target = document.getElementById('canvas' + stage.charAt(0).toUpperCase() + stage.slice(1));
            if (target) target.classList.add('active');
        }
        
        // ÈáçÁΩÆËØäÊñ≠ÔºàÈáçÊñ∞ÂºÄÂßãÔºâ
        function resetCanvas() {
            resetCanvasStage('waiting');
            addMessage('ËØ∑ÊîæÁΩÆÊñ∞ÁöÑÂç°ÁâáËøõË°åËØäÊñ≠ÔºåÊàñÁÇπÂáª"ÊºîÁ§∫Âú∫ÊôØ"Êü•ÁúãÂÖ∂‰ªñËØäÊñ≠ÁªìÊûú„ÄÇ', 'ai');
        }
        
        // Ê®°ÊãüÊ£ÄÊµãÂà∞Âç°ÁâáÔºàÂÆûÈôÖÁî±Á°¨‰ª∂ÂõûË∞ÉÔºâ- Áî®‰∫éÁúüÂÆûÂú∫ÊôØ
        function simulateCardDetected() {
            simulateScenario('expired'); // ÈªòËÆ§ÊºîÁ§∫ËøáÊúüÂú∫ÊôØ
        }
        
        // ÊòæÁ§∫ËØäÊñ≠ÁªìÊûú
        function showDiagnosisResult(scenario = 'expired') {
            const data = scenarioData[scenario] || scenarioData.expired;
            
            // Êõ¥Êñ∞ Canvas ÁªìÊûúÂç°Áâá
            const header = document.getElementById('resultHeader');
            const title = document.getElementById('resultTitle');
            const lockEl = document.getElementById('resLock');
            
            header.className = 'result-header ' + data.status;
            title.textContent = data.title;
            
            document.getElementById('resRoom').textContent = data.room;
            document.getElementById('resType').textContent = data.type;
            document.getElementById('resExpiry').textContent = data.expiry;
            lockEl.textContent = data.lockStatus;
            lockEl.className = 'result-value ' + (data.lockStatusClass || '');
            
            // ÂàáÊç¢Âà∞ÁªìÊûúÈò∂ÊÆµ
            resetCanvasStage('result');
            
            // ÂêåÊ≠•Âà∞ÂØπËØùÂå∫
            addMessage(data.aiMessage, 'ai');
        }
        
        // ========== ÂéüÊúâÂØπËØùÂäüËÉΩ ==========

        // ‰ªéÊ¨¢ËøéÈ°µÂºÄÂßãÂØπËØù
        function startChat(text) {
            const welcome = document.getElementById('aiWelcome');
            const messages = document.getElementById('aiMessages');
            const quickPrompts = document.querySelector('.quick-prompts');
            
            // ÈöêËóèÊ¨¢ËøéÈ°µÔºåÊòæÁ§∫ÂØπËØùÂå∫
            welcome.classList.add('hidden');
            messages.classList.remove('hidden');
            if (quickPrompts) quickPrompts.style.display = 'flex';
            
            // ÂèëÈÄÅÁî®Êà∑Ê∂àÊÅØ
            addMessage(text, 'user');
            
            // Ê®°Êãü AI ÂõûÂ§ç
            setTimeout(() => {
                addMessage('ÊàëÊ≠£Âú®Â§ÑÁêÜÊÇ®ÁöÑÈóÆÈ¢òÔºö„Äå' + text + '„ÄçÔºåËØ∑Á®çÂÄô...', 'ai');
            }, 500);
        }

        // Ê®°ÊãüÁü•ËØÜÂ∫ìÈóÆÁ≠î
        const faqKnowledge = {
            'ÂÅ•Ë∫´Êàø': 'ÈÖíÂ∫óÂÅ•Ë∫´Êàø‰Ωç‰∫é **3Ê•º**ÔºåÂºÄÊîæÊó∂Èó¥‰∏∫ **6:00-22:00**„ÄÇ\n\nüîë **ËøõÂÖ•ÊñπÂºè**Ôºö‰ΩøÁî®ÊÇ®ÁöÑÊàøÂç°Âú®ÂÅ•Ë∫´ÊàøÈó®Âè£Âà∑Âç°Âç≥ÂèØËøõÂÖ•ÔºåÁ≥ªÁªü‰ºöËá™Âä®È™åËØÅÊÇ®ÁöÑÂÖ•‰ΩèÁä∂ÊÄÅ„ÄÇ\n\nüí° **Ê∏©È¶®ÊèêÁ§∫**Ôºö\n- ËØ∑Á©øÁùÄËøêÂä®ÊúçË£ÖÂíåËøêÂä®Èûã\n- ÂÅ•Ë∫´ÊàøÂÜÖÊèê‰æõÂÖçË¥πÁüøÊ≥âÊ∞¥ÂíåÊØõÂ∑æ\n- Â¶ÇÈúÄÁßÅÊïôÊúçÂä°ËØ∑ÊèêÂâçÈ¢ÑÁ∫¶',
            'Ê∏∏Ê≥≥Ê±†': 'ÈÖíÂ∫óÊ∏∏Ê≥≥Ê±†‰Ωç‰∫é **5Ê•º**ÔºåÂºÄÊîæÊó∂Èó¥‰∏∫ **7:00-21:00**„ÄÇ\n\nüîë **ËøõÂÖ•ÊñπÂºè**Ôºö‰ΩøÁî®ÊàøÂç°Âú®Ê≥≥Ê±†ÂÖ•Âè£Âà∑Âç°ËøõÂÖ•„ÄÇ\n\n‚ö†Ô∏è **Ê≥®ÊÑè‰∫ãÈ°π**Ôºö\n- ËØ∑‰Ω©Êà¥Ê≥≥Â∏Ω\n- 12Â≤Å‰ª•‰∏ãÂÑøÁ´•ÈúÄÊàê‰∫∫Èô™Âêå\n- Ê≥≥Ê±†Ê∑±Â∫¶1.2m-1.8m',
            'Êó©È§ê': 'ÈÖíÂ∫óÊó©È§êÂú® **2Ê•ºÂÖ®Êó•È§êÂéÖ** ‰æõÂ∫î„ÄÇ\n\n‚è∞ **‰æõÂ∫îÊó∂Èó¥**Ôºö\n- Âë®‰∏ÄËá≥Âë®‰∫îÔºö6:30-10:00\n- Âë®Êú´ÂèäËäÇÂÅáÊó•Ôºö6:30-10:30\n\nüí∞ **‰ª∑Ê†º**Ôºö\n- ‰ΩèÂÆ¢‰ºòÊÉ†‰ª∑Ôºö¬•68/‰Ωç\n- Èó®Â∏Ç‰ª∑Ôºö¬•98/‰Ωç\n\nüçΩÔ∏è Êèê‰æõ‰∏≠Ë•øÂºèËá™Âä©È§êÔºåÁ∫¶80+ËèúÂìÅ',
            'wifi': 'ÈÖíÂ∫óÂÖ®Ë¶ÜÁõñÂÖçË¥π WiFi„ÄÇ\n\nüì∂ **ËøûÊé•ÊñπÂºè**Ôºö\n1. ÊêúÁ¥¢ÁΩëÁªúÂêçÁß∞Ôºö**Hotel-Guest**\n2. ÊâìÂºÄÊµèËßàÂô®ÔºåËæìÂÖ•ÊàøÈó¥Âè∑ÂíåÊâãÊú∫Â∞æÂè∑4‰ΩçÈ™åËØÅ\n3. È™åËØÅÊàêÂäüÂêéÂç≥ÂèØ‰ΩøÁî®\n\nüí° Â¶ÇÈÅáËøûÊé•ÈóÆÈ¢òÔºåÂèØÊã®ÊâìÂâçÂè∞ **8888** ÂØªÊ±ÇÂ∏ÆÂä©',
            'ÈÄÄÊàø': 'ÈÄÄÊàøÊó∂Èó¥‰∏∫ **‰∏≠Âçà12:00**„ÄÇ\n\n‚è∞ **Âª∂ËøüÈÄÄÊàø**Ôºö\n- 12:00-14:00ÔºöÂÖçË¥πÔºàËßÜÊàøÊÄÅÔºâ\n- 14:00-18:00ÔºöÂä†Êî∂ÂçäÂ§©ÊàøË¥π\n- 18:00ÂêéÔºöÂä†Êî∂ÂÖ®Â§©ÊàøË¥π\n\nüìç ËØ∑Â∞ÜÊàøÂç°‰∫§ËøòÂâçÂè∞ÔºåÊàë‰ª¨‰ºö‰∏∫ÊÇ®ÂäûÁêÜÈÄÄÊàøÊâãÁª≠',
            'ÂÅúËΩ¶': 'ÈÖíÂ∫óÊèê‰æõ **Âú∞‰∏ãÂÅúËΩ¶Âú∫**ÔºåÂÖ•Âè£Âú®ÈÖíÂ∫ó‰∏ú‰æß„ÄÇ\n\nüöó **Êî∂Ë¥πÊ†áÂáÜ**Ôºö\n- ‰ΩèÂÆ¢ÔºöÂÖçË¥πÔºàÂá≠ÊàøÂç°Ôºâ\n- ËÆøÂÆ¢Ôºö¬•10/Â∞èÊó∂Ôºå¬•60Â∞ÅÈ°∂\n\nüí° Âá∫Âú∫Êó∂Âú®Êî∂Ë¥πÂ§ÑÂá∫Á§∫ÊàøÂç°Âç≥ÂèØÂÖçË¥πÁ¶ªÂú∫',
            'Èó®ÈîÅ': 'Â¶ÇÈÅáÊàøÂç°Êó†Ê≥ïÂºÄÈó®ÔºåËØ∑Â∞ùËØï‰ª•‰∏ãÊ≠•È™§Ôºö\n\n1Ô∏è‚É£ Á°ÆËÆ§ÊàøÂç°ÊòØÂê¶Ê≠£Á°ÆÊèíÂÖ•/Èù†ËøëÊÑüÂ∫îÂå∫\n2Ô∏è‚É£ Ê£ÄÊü•ÊàøÂç°ÊòØÂê¶ËøáÊúüÔºàÂèØÂú®ÂâçÂè∞Êü•ËØ¢Ôºâ\n3Ô∏è‚É£ Â∞ùËØïÈáçÊñ∞ÊèíÊãîÊàøÂç°\n\nÂ¶Ç‰ªçÊó†Ê≥ïËß£ÂÜ≥ÔºåËØ∑Êã®ÊâìÂâçÂè∞ **8888**ÔºåÊàë‰ª¨‰ºöÁ´ãÂç≥Ê¥æÂ∑•Á®ã‰∫∫ÂëòÂçèÂä©„ÄÇ\n\n‚ö†Ô∏è ËØ∑ÂãøÂ∞ÜÊàøÂç°‰∏éÊâãÊú∫„ÄÅÁ£ÅÈìÅÁ≠âÊîæÂú®‰∏ÄËµ∑ÔºåÂèØËÉΩÂØºËá¥Ê∂àÁ£Å',
            'Ê¥óË°£': 'ÈÖíÂ∫óÊèê‰æõÊ¥óË°£ÊúçÂä°„ÄÇ\n\nüëî **ÈÄÅÊ¥óÊñπÂºè**Ôºö\n1. Â°´ÂÜôÊàøÈó¥ÂÜÖÁöÑÊ¥óË°£Âçï\n2. Â∞ÜË°£Áâ©ÊîæÂÖ•Ê¥óË°£Ë¢ã\n3. Êã®Êâì **8866** ÈÄöÁü•ÂÆ¢ÊàøÊúçÂä°Êî∂Âèñ\n\n‚è∞ **ÂèñË°£Êó∂Èó¥**Ôºö\n- ÊôÆÈÄöÊúçÂä°ÔºöÊ¨°Êó•18:00Ââç\n- Âä†ÊÄ•ÊúçÂä°ÔºöÂΩìÊó•ÂèñÔºàÂä†Êî∂50%Ë¥πÁî®Ôºâ'
        };

        function getAIResponse(question) {
            const q = question.toLowerCase();
            
            // ÂåπÈÖçÂÖ≥ÈîÆËØç
            for (const [keyword, answer] of Object.entries(faqKnowledge)) {
                if (q.includes(keyword.toLowerCase())) {
                    return answer;
                }
            }
            
            // Êú™ÂåπÈÖçÂà∞ÁöÑÈªòËÆ§ÂõûÂ§ç
            if (q.includes('‰Ω†Â•Ω') || q.includes('Âú®Âêó')) {
                return '‰Ω†Â•ΩÔºÅÊàëÊòØ HostPilotÔºåÊÇ®ÁöÑÊô∫ËÉΩÈÖíÂ∫óÂä©Êâã„ÄÇÊúâ‰ªÄ‰πàÂèØ‰ª•Â∏ÆÊÇ®ÁöÑÂêóÔºü\n\nÊÇ®ÂèØ‰ª•ÈóÆÊàëÂÖ≥‰∫éÔºö\n- üèä ÈÖíÂ∫óËÆæÊñΩÔºàÂÅ•Ë∫´Êàø„ÄÅÊ∏∏Ê≥≥Ê±†Á≠âÔºâ\n- üç≥ È§êÈ•ÆÊúçÂä°\n- üîë ÊàøÂç°/Èó®ÈîÅÈóÆÈ¢ò\n- üöó ÂÅúËΩ¶ÊåáÂºï\n- ‚è∞ ÂÖ•‰Ωè/ÈÄÄÊàøÊó∂Èó¥';
            }
            
            return 'Êä±Ê≠âÔºåÊàëÊöÇÊó∂Êó†Ê≥ïÂõûÁ≠îËøô‰∏™ÈóÆÈ¢ò„ÄÇ\n\nÊÇ®ÂèØ‰ª•Â∞ùËØïÔºö\n- Êç¢‰∏™ÊñπÂºèÊèèËø∞ÊÇ®ÁöÑÈóÆÈ¢ò\n- Êã®ÊâìÂâçÂè∞ÁîµËØù **8888** Âí®ËØ¢\n\nüí° ÊàëÂèØ‰ª•ÂõûÁ≠îÂÖ≥‰∫éÈÖíÂ∫óËÆæÊñΩ„ÄÅÊúçÂä°Êó∂Èó¥„ÄÅÊàøÂç°‰ΩøÁî®Á≠âÈóÆÈ¢ò';
        }

        // ÂèëÈÄÅÊ∂àÊÅØ
        function sendMessage() {
            const input = document.getElementById('aiInput');
            const text = input.value.trim();
            if (!text) return;

            // ‰øùÂ≠òÁî®Êà∑Ê∂àÊÅØÁî®‰∫éÈáçËØï
            lastUserMessage = text;

            // Â¶ÇÊûúÊ¨¢ËøéÈ°µËøòÂú®ÊòæÁ§∫ÔºåÂÖàÂàáÊç¢Âà∞ÂØπËØùÊ®°Âºè
            const welcome = document.getElementById('aiWelcome');
            if (welcome && !welcome.classList.contains('hidden')) {
                welcome.classList.add('hidden');
                document.getElementById('aiMessages').classList.remove('hidden');
                document.querySelector('.quick-prompts').style.display = 'flex';
            }

            addMessage(text, 'user');
            input.value = '';

            // Ê®°Êãü AI ÂõûÂ§çÔºàÂ∏¶ÊâìÂ≠óÊïàÊûúÂª∂ËøüÔºâ
            setTimeout(() => {
                const response = getAIResponse(text);
                addMessage(response, 'ai');
            }, 800);
        }

        // Ê∑ªÂä†Ê∂àÊÅØ
        function addMessage(text, type) {
            const messages = document.getElementById('aiMessages');
            const now = new Date();
            const timeStr = now.toLocaleTimeString('zh-CN', {hour: '2-digit', minute: '2-digit'});
            
            const msgDiv = document.createElement('div');
            msgDiv.className = 'message ' + type;
            // ÁÆÄÂçïÁöÑ Markdown ËΩ¨ HTML
            let formattedText = text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')  // Âä†Á≤ó
                .replace(/\n/g, '<br>');  // Êç¢Ë°å
            
            msgDiv.innerHTML = `
                <div class="message-bubble">${formattedText}</div>
                <div class="message-time">${timeStr}</div>
            `;
            messages.appendChild(msgDiv);
            messages.scrollTop = messages.scrollHeight;
        }

        // Âø´Êç∑ÊèêÈóÆ
        function sendQuickPrompt(text) {
            document.getElementById('aiInput').value = text;
            sendMessage();
        }

        // ÈáçËØï‰∏ä‰∏ÄÊù°Ê∂àÊÅØ
        let lastUserMessage = '';
        function retryLastMessage() {
            if (lastUserMessage) {
                document.getElementById('aiInput').value = lastUserMessage;
                sendMessage();
            }
        }

        // ÊåâÈîÆÂ§ÑÁêÜ
        function handleKeyDown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // ÁõëÂê¨ iframe ÂÜÖÁöÑÂØºËà™ËØ∑Ê±Ç
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'navigate') {
                closeNotifyPanel();
                document.getElementById('mainFrame').src = event.data.url;
            }
            if (event.data && event.data.type === 'openAI') {
                toggleAI();
            }
            if (event.data && event.data.type === 'toggleNotify') {
                toggleNotifyPanel();
            }
            if (event.data && event.data.type === 'closeNotify') {
                closeNotifyPanel();
            }
            if (event.data && event.data.type === 'requestNotifyCount') {
                sendNotifyCountTo(event.source);
            }
        });

        // ÈÄöÁü•Èù¢ÊùøÔºàÁî± iframe ÂÜÖÈ°∂ÈÉ®Ê†èÈìÉÈìõËß¶ÂèëÔºâ
        const notifyState = {
            filter: 'unread',
            items: [
                { id: 'n1', module: 'ÂÆâÂÖ®ËøêÁª¥', level: 'urgent', title: 'ÁΩëÂÖ≥ GW-02 Á¶ªÁ∫ø 4 Â∞èÊó∂ÔºåÂΩ±Âìç 28 Âè∞ËÆæÂ§á', meta: 'Âª∫ËÆÆ‰ºòÂÖàÊÅ¢Â§çÁΩëÂÖ≥ÈÄö‰ø°', time: '2025/12/11 10:12', url: 'security-ops-dashboard.html', unread: true },
                { id: 'n2', module: 'ÂâçÂéÖËøêËê•', level: 'warning', title: 'Ë∂ÖÊó∂Êú™ÈÄÄÊàø 3 Èó¥Ôºö0305 / 0402 / 0608', meta: 'Âª∫ËÆÆÂ∞ΩÂø´ËÅîÁ≥ªÁ°ÆËÆ§Áª≠‰ΩèÊàñÈÄÄÊàø', time: '2025/12/11 10:05', url: 'front-office-dashboard.html', unread: true },
                { id: 'n3', module: 'ÂÆâÂÖ®ËøêÁª¥', level: 'warning', title: '‰ΩéÁîµÈáèËÆæÂ§á 8 Âè∞Ôºà0402 8%„ÄÅ1008 15%Ôºâ', meta: 'Âª∫ËÆÆ‰ºòÂÖàÊõ¥Êç¢ <10% ËÆæÂ§áÁîµÊ±†', time: '2025/12/11 09:58', url: 'security-ops-dashboard.html', unread: true },
                { id: 'n4', module: 'Êï∞ÊçÆÊÄªËßà', level: 'info', title: 'Èó®Êú™ÂÖ≥ÂëäË≠¶Âπ≥ÂùáÂìçÂ∫î 4.2 ÂàÜÈíüÔºàËæÉ‰∏äÂë® +18%Ôºâ', meta: 'Âª∫ËÆÆÂ§çÊ†∏ÂÄºÂÆà‰∏éÂëäË≠¶Ëß¶ËææÊïàÁéá', time: '2025/12/11 09:42', url: 'overview-dashboard.html', unread: true },
                { id: 'n5', module: 'ÂÆâÂÖ®ËøêÁª¥', level: 'urgent', title: '0815 ÊàøËß¶Âèë‚ÄúÈ£ûÊàø‚ÄùÂëäË≠¶Ôºå‰∏îÂêåÊó∂ËÆæÂ§áÁ¶ªÁ∫ø', meta: 'Âª∫ËÆÆÁ´ãÂç≥Áé∞Âú∫Ê†∏Êü•ÊéíÈô§ËØØÊä•/È£éÈô©', time: '2025/12/11 09:30', url: 'security-ops-dashboard.html', unread: true },
                { id: 'n6', module: 'ÂâçÂéÖËøêËê•', level: 'info', title: 'È¢ÑËÆ°ÂÖ•‰ΩèÈ´òÂ≥∞ 17:00-19:00ÔºåÂ∞öÊúâ 18 Èó¥È¢ÑÊäµ', meta: 'Âª∫ËÆÆÊèêÂâçÂÆâÊéíÂâçÂè∞‰∫∫Êâã‰∏éÂà∂Âç°ÂáÜÂ§á', time: '2025/12/11 09:15', url: 'front-office-dashboard.html', unread: false },
                { id: 'n7', module: 'ÂâçÂéÖËøêËê•', level: 'warning', title: 'ÂèåÂ∫äÊàøÂÖ•‰ΩèÁéá 84%ÔºåÂª∫ËÆÆÂπ≥Ë°°Êé®ËçêÂ§ßÂ∫äÊàøÔºà75%Ôºâ', meta: 'ÈÅøÂÖçÂêéÁª≠ÊàøÂûãÁ¥ßÂº†ÂØºËá¥Ë∞ÉÊàø', time: '2025/12/11 09:10', url: 'front-office-dashboard.html', unread: false },
                { id: 'n8', module: 'ÂÆâÂÖ®ËøêÁª¥', level: 'warning', title: '3F ÂºÄÈó®Â§±Ë¥•Áéá 8.5%ÔºàÂÖ®Â∫óÂùáÂÄº 3.2%Ôºâ', meta: 'Áñë‰ººÁΩëÂÖ≥/‰ø°Âè∑ÈóÆÈ¢òÂØºËá¥ÈõÜ‰∏≠Â§±Ë¥•', time: '2025/12/11 09:02', url: 'security-ops-dashboard.html', unread: false },
                { id: 'n9', module: 'Êï∞ÊçÆÊÄªËßà', level: 'info', title: 'ÂÖ•‰Ωè‚ÜíÈ¶ñÊ¨°ÂºÄÈó®Âπ≥ÂùáÈó¥Èöî 12.6 ÂàÜÈíü', meta: 'Âª∫ËÆÆÂÖ≥Ê≥®Âà∂Âç°Âà∞ÂÆ¢ÊàøÂºïÂØºÊµÅÁ®ã', time: '2025/12/11 08:55', url: 'overview-dashboard.html', unread: false },
                { id: 'n10', module: 'ÂÆâÂÖ®ËøêÁª¥', level: 'info', title: 'Êñ∞Â¢ûÂÆâÂÖ®‰∫ã‰ª∂ÔºöÂ∞æÈöèÂëäË≠¶ 1 Ëµ∑Ôºà5FÔºâ', meta: 'Âª∫ËÆÆÂ§çÊ†∏ËßÜÈ¢ë/Â∑°Êü•ËÆ∞ÂΩï', time: '2025/12/11 08:41', url: 'security-ops-dashboard.html', unread: false },
                { id: 'n11', module: 'ÂâçÂéÖËøêËê•', level: 'warning', title: 'È¢ÑÊäµÂÆ¢Êàø‰ªçÊú™ÂÆåÊàêÊàøÊÄÅÂáÜÂ§áÔºö12 Â±Ç 6 Èó¥', meta: 'Âª∫ËÆÆÂçèË∞ÉÊ∏ÖÊ¥ÅÊéíÁè≠/‰ºòÂÖàÊâìÊâ´', time: '2025/12/11 08:35', url: 'front-office-dashboard.html', unread: false },
                { id: 'n12', module: 'ÂÆâÂÖ®ËøêÁª¥', level: 'info', title: 'ËÆæÂ§áÂºÇÂ∏∏ÁéáËæÉ‰∏äÂë® +12%ÔºàÈõÜ‰∏≠ 3F/5FÔºâ', meta: 'Âª∫ËÆÆÈáçÁÇπÂ∑°Ê£ÄÊ•ºÂ±Ç‰∏éÁΩëÂÖ≥Á®≥ÂÆöÊÄß', time: '2025/12/11 08:20', url: 'security-ops-dashboard.html', unread: false },
                { id: 'n13', module: 'Êï∞ÊçÆÊÄªËßà', level: 'info', title: 'ÈÄÄÊàø‚ÜíÁ©∫ÂáÄÂπ≥ÂùáËÄóÊó∂ 28 ÂàÜÈíüÔºàÁõÆÊ†á ‚â§25 ÂàÜÈíüÔºâ', meta: 'Âª∫ËÆÆ‰ºòÂåñÊ∏ÖÊ¥ÅË∞ÉÂ∫¶‰∏éÈ™åÊàøËäÇÂ•è', time: '2025/12/11 08:05', url: 'overview-dashboard.html', unread: false },
                { id: 'n14', module: 'ÂÆâÂÖ®ËøêÁª¥', level: 'warning', title: 'ÈóÆÈ¢òËÆæÂ§áÔºöÁ¶ªÁ∫ø 2 Âè∞ / ‰ΩéÁîµÈáè 8 Âè∞', meta: 'Âª∫ËÆÆÂÖàÂ§ÑÁêÜÁ¶ªÁ∫øÔºåÂÜçÂ§ÑÁêÜ <20% ÁîµÈáè', time: '2025/12/11 07:50', url: 'security-ops-dashboard.html', unread: false },
                { id: 'n15', module: 'ÂâçÂéÖËøêËê•', level: 'info', title: '‰ªäÊó•ÊàøÊÄÅÂèòÊõ¥È¢ëÁπÅÔºöÈÄÄÊàø 12 / ÂÖ•‰Ωè 18', meta: 'Âª∫ËÆÆÂÖ≥Ê≥®È´òÂ≥∞ÊúüÂäûÁêÜÊïàÁéá', time: '2025/12/11 07:40', url: 'front-office-dashboard.html', unread: false },
                { id: 'n16', module: 'ÂÆâÂÖ®ËøêÁª¥', level: 'warning', title: 'ÂÆûÊó∂‰∫ã‰ª∂ÊµÅÔºöÈó®Êú™ÂÖ≥ÂëäË≠¶ 2 Ëµ∑Ôºà10 ÂàÜÈíüÂÜÖÔºâ', meta: 'Âª∫ËÆÆÊèêÈÜíÂ∑°Ê•º/Â§çÊ†∏ÊàøÈó®Áä∂ÊÄÅ', time: '2025/12/11 07:35', url: 'security-ops-dashboard.html', unread: false },
                { id: 'n17', module: 'Êï∞ÊçÆÊÄªËßà', level: 'info', title: 'Ë∂ÖÊó∂ÈÄÄÊàøÂç†ÊØî 6.8%ÔºàËæÉÊò®Êó• +1.2ppÔºâ', meta: 'Âª∫ËÆÆÂä†Âº∫ÈÄÄÊàøÊèêÈÜí‰∏éÊµÅÁ®ã', time: '2025/12/11 07:20', url: 'overview-dashboard.html', unread: false },
                { id: 'n18', module: 'ÂÆâÂÖ®ËøêÁª¥', level: 'info', title: 'ÁΩëÂÖ≥Âú®Á∫øÁéá 98.6%ÔºàÊ≠£Â∏∏Ôºâ', meta: 'ÊåÅÁª≠ÁõëÊéßÂº±‰ø°Âè∑ÁΩëÂÖ≥', time: '2025/12/11 07:10', url: 'security-ops-dashboard.html', unread: false }
            ]
        };

        function toggleNotifyPanel() {
            const panel = document.getElementById('notifyPanel');
            panel.classList.toggle('show');
            if (panel.classList.contains('show')) {
                renderNotifyList();
            }
        }

        function closeNotifyPanel() {
            const panel = document.getElementById('notifyPanel');
            panel.classList.remove('show');
        }

        function setNotifyFilter(filter) {
            notifyState.filter = filter;
            document.getElementById('notifyFilterAll').classList.toggle('active', filter === 'all');
            document.getElementById('notifyFilterUnread').classList.toggle('active', filter === 'unread');
            renderNotifyList();
        }

        function markAllRead() {
            notifyState.items.forEach(i => (i.unread = false));
            renderNotifyList();
        }

        function getUnreadCount() {
            return notifyState.items.filter(i => i.unread).length;
        }

        function sendNotifyCountTo(targetWindow) {
            if (!targetWindow) return;
            targetWindow.postMessage({ type: 'notifyCount', count: getUnreadCount() }, '*');
        }

        function broadcastNotifyCount() {
            const count = getUnreadCount();
            const frame = document.getElementById('mainFrame');
            if (frame && frame.contentWindow) {
                frame.contentWindow.postMessage({ type: 'notifyCount', count }, '*');
            }
        }

        function renderNotifyList() {
            const list = document.getElementById('notifyList');
            const items = notifyState.filter === 'unread'
                ? notifyState.items.filter(i => i.unread)
                : notifyState.items;

            if (items.length === 0) {
                list.innerHTML = '<div class="notify-empty">ÊöÇÊó†' + (notifyState.filter === 'unread' ? 'Êú™ËØª' : '') + 'ÈÄöÁü•</div>';
            } else {
                list.innerHTML = items.map(i => {
                    const levelText = i.level === 'urgent' ? 'Á¥ßÊÄ•' : (i.level === 'warning' ? 'Ë≠¶Âëä' : 'ÊèêÁ§∫');
                    return (
                        '<div class="notify-item ' + (i.unread ? 'unread' : '') + '" onclick="openNotify(\'' + i.id + '\')">'
                        +   '<div class="notify-row">'
                        +     '<span class="notify-dot"></span>'
                        +     '<span class="notify-pill">' + i.module + '</span>'
                        +     '<span class="notify-level ' + i.level + '">' + levelText + '</span>'
                        +   '</div>'
                        +   '<div class="notify-title" style="margin-top:6px">' + i.title + '</div>'
                        +   (i.meta ? '<div class="meta">' + i.time + ' ¬∑ ' + i.meta + '</div>' : '<div class="meta">' + i.time + '</div>')
                        + '</div>'
                    );
                }).join('');
            }

            // Êú™ËØªÊï∞ÂêåÊ≠•Âà∞ iframe È°∂ÈÉ®ÈìÉÈìõ
            broadcastNotifyCount();
        }

        function openNotify(id) {
            const item = notifyState.items.find(i => i.id === id);
            if (!item) return;
            // ‚ÄúÁÇπËøõËØ¶ÊÉÖÊâçÁÆóÂ∑≤ËØª‚ÄùÔºöÊâìÂºÄËØ¶ÊÉÖÂºπÁ™óÂç≥ËßÜ‰∏∫ËøõÂÖ•ËØ¶ÊÉÖ
            item.unread = false;
            closeNotifyPanel();
            broadcastNotifyCount();
            showNotifyDetail(item);
        }

        let currentNotifyDetailId = null;
        function showNotifyDetail(item) {
            currentNotifyDetailId = item?.id || null;

            const overlay = document.getElementById('notifyDetailOverlay');
            const moduleEl = document.getElementById('notifyDetailModule');
            const levelEl = document.getElementById('notifyDetailLevel');
            const timeEl = document.getElementById('notifyDetailTime');
            const titleEl = document.getElementById('notifyDetailTitle');
            const metaEl = document.getElementById('notifyDetailMeta');
            const goBtn = document.getElementById('notifyDetailGoBtn');

            if (!overlay || !moduleEl || !levelEl || !timeEl || !titleEl || !metaEl || !goBtn) return;

            const levelText = item.level === 'urgent' ? 'Á¥ßÊÄ•' : (item.level === 'warning' ? 'Ë≠¶Âëä' : 'ÊèêÁ§∫');

            moduleEl.textContent = item.module || '-';
            levelEl.textContent = levelText;
            levelEl.className = 'notify-level ' + (item.level || 'info');
            timeEl.textContent = item.time || '-';
            titleEl.textContent = item.title || '-';
            metaEl.textContent = item.meta || '‚Äî';

            // Ê≤°ÊúâÁõÆÊ†áÈ°µÈù¢Êó∂ÈöêËóè‚ÄúÂâçÂæÄ‚ÄùÊåâÈíÆ
            goBtn.style.display = item.url ? 'inline-flex' : 'none';

            overlay.classList.add('show');
        }

        function closeNotifyDetail() {
            currentNotifyDetailId = null;
            const overlay = document.getElementById('notifyDetailOverlay');
            if (overlay) overlay.classList.remove('show');
        }

        function goNotifyDetailTarget() {
            if (!currentNotifyDetailId) return;
            const item = notifyState.items.find(i => i.id === currentNotifyDetailId);
            if (!item || !item.url) return;
            closeNotifyDetail();
            document.getElementById('mainFrame').src = item.url;
        }

        // È¶ñÊ¨°ÂàùÂßãÂåñÔºöÊé®ÈÄÅ‰∏ÄÊ¨°Êú™ËØªÊï∞ÔºàÁî®‰∫éÈªòËÆ§È°µÈù¢ËßíÊ†áÔºâ
        window.addEventListener('load', function() {
            broadcastNotifyCount();
        });

        // ‰øÆÂ§çÔºöiframe È°µÈù¢ÊØèÊ¨°Âä†ËΩΩ/ÂàáÊç¢ÂêéÔºåÈáçÊñ∞Êé®ÈÄÅÊú™ËØªÊï∞
        (function bindNotifyCountToFrameLoad() {
            const frame = document.getElementById('mainFrame');
            if (!frame) return;
            frame.addEventListener('load', function() {
                closeNotifyPanel();
                broadcastNotifyCount();
            });

            // ÂÖúÂ∫ïÔºöÈÅøÂÖçÂ§ñÂ±Ç load Êó©‰∫é iframe ÂÆåÊàêÂØºËá¥ËßíÊ†á‰ªçÊòØÈªòËÆ§ÂÄº
            setTimeout(() => broadcastNotifyCount(), 0);
        })();

        function openNotifySettings() {
            alert('Âç≥Â∞ÜÊâìÂºÄÈÄöÁü•ËÆæÁΩÆÔºàÈÇÆ‰ª∂ÈÄöÁü•/ËßÑÂàôÈÖçÁΩÆÔºâ...');
        }

        // ÁÇπÂáªÁ©∫ÁôΩÂ§ÑÂÖ≥Èó≠ÈÄöÁü•Èù¢ÊùøÔºàÂª∂ËøüÊâßË°åÔºåÈÅøÂÖç‰∏éÈìÉÈìõÁÇπÂáªÂÜ≤Á™ÅÔºâ
        let notifyJustOpened = false;
        const origToggleNotifyPanel = toggleNotifyPanel;
        toggleNotifyPanel = function() {
            const panel = document.getElementById('notifyPanel');
            const wasHidden = !panel.classList.contains('show');
            origToggleNotifyPanel();
            if (wasHidden && panel.classList.contains('show')) {
                notifyJustOpened = true;
                setTimeout(() => { notifyJustOpened = false; }, 100);
            }
        };
        document.addEventListener('click', function(e) {
            if (notifyJustOpened) return;
            const panel = document.getElementById('notifyPanel');
            if (!panel.classList.contains('show')) return;
            if (panel.contains(e.target)) return;
            panel.classList.remove('show');
        });

        // ESC ÂÖ≥Èó≠ÈÄöÁü•ËØ¶ÊÉÖÂºπÁ™ó
        document.addEventListener('keydown', function(e) {
            if (e.key !== 'Escape') return;
            const overlay = document.getElementById('notifyDetailOverlay');
            if (overlay && overlay.classList.contains('show')) {
                closeNotifyDetail();
            }
        });
    </script>
</body>
</html>
